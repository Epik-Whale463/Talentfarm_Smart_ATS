{% extends "base.html" %}

{% block title %}HR Dashboard - AI-Powered ATS{% endblock %}

{% block content %}
<style>
/* Japanese-inspired Bento Grid Layout for HR Dashboard */
.hr-bento {
    display: grid;
    grid-template-columns: repeat(16, 1fr);
    grid-template-rows: repeat(7, minmax(85px, auto));
    gap: 8px;
    margin-bottom: 1.5rem;
    max-width: 100%;
    padding: 0;
}

.bento-item {
    border-radius: 8px;
    padding: 0.8rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    transition: all 0.15s ease;
    position: relative;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.03);
    box-shadow: 0 1px 4px rgba(0,0,0,0.02);
    backdrop-filter: blur(8px);
    min-height: 80px;
}

.bento-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    border-color: rgba(0, 0, 0, 0.08);
}

/* HR Header Section */
.hr-header {
    grid-column: 1 / 12;
    grid-row: 1 / 2;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    justify-content: flex-start;
    border-left: 2px solid #667eea;
    padding: 1rem;
}

.hr-quick-stats {
    grid-column: 12 / 17;
    grid-row: 1 / 2;
    background: linear-gradient(135deg, rgba(245, 87, 108, 0.08) 0%, rgba(240, 147, 251, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #f55768;
}

/* Main Stats Row */
.jobs-stat {
    grid-column: 1 / 4;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(67, 233, 123, 0.08) 0%, rgba(56, 249, 215, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #43e97b;
}

.applications-stat {
    grid-column: 4 / 7;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(250, 112, 154, 0.08) 0%, rgba(254, 225, 64, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #fa709a;
}

.pending-stat {
    grid-column: 7 / 10;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(255, 154, 158, 0.12) 0%, rgba(254, 207, 239, 0.12) 100%);
    color: #2d3748;
    border-left: 2px solid #ff9a9e;
}

.interviews-stat {
    grid-column: 10 / 13;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.08) 0%, rgba(0, 242, 254, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #4facfe;
}

.candidates-stat {
    grid-column: 13 / 17;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(161, 140, 209, 0.12) 0%, rgba(251, 194, 235, 0.12) 100%);
    color: #2d3748;
    border-left: 2px solid #a18cd1;
}

/* Action Items Row */
.post-job-action {
    grid-column: 1 / 5;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(168, 237, 234, 0.15) 0%, rgba(254, 214, 227, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #a8edea;
    cursor: pointer;
}

.view-applications-action {
    grid-column: 5 / 9;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(110, 193, 228, 0.15) 0%, rgba(254, 214, 227, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #6ec1e4;
    cursor: pointer;
}

.manage-interviews-action {
    grid-column: 9 / 13;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(250, 208, 196, 0.15) 0%, rgba(255, 209, 255, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #fad0c4;
    cursor: pointer;
}

.analytics-action {
    grid-column: 13 / 17;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(138, 43, 226, 0.08) 0%, rgba(75, 0, 130, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #8a2be2;
    cursor: pointer;
}

/* Main Content Areas */
.recent-applications {
    grid-column: 1 / 9;
    grid-row: 4 / 7;
    background: linear-gradient(135deg, rgba(250, 208, 196, 0.15) 0%, rgba(255, 209, 255, 0.15) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #fad0c4;
    min-height: 220px;
}

.job-management {
    grid-column: 9 / 17;
    grid-row: 4 / 7;
    background: linear-gradient(135deg, rgba(161, 140, 209, 0.12) 0%, rgba(251, 194, 235, 0.12) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #a18cd1;
    min-height: 220px;
}

/* Performance Metrics Row */
.performance-metrics {
    grid-column: 1 / 17;
    grid-row: 7 / 8;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #667eea;
    min-height: 120px;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .hr-bento {
        grid-template-columns: repeat(12, 1fr);
    }
    
    .hr-header { grid-column: 1 / 9; }
    .hr-quick-stats { grid-column: 9 / 13; }
    
    .jobs-stat { grid-column: 1 / 3; }
    .applications-stat { grid-column: 3 / 5; }
    .pending-stat { grid-column: 5 / 7; }
    .interviews-stat { grid-column: 7 / 9; }
    .candidates-stat { grid-column: 9 / 13; }
    
    .post-job-action { grid-column: 1 / 4; }
    .view-applications-action { grid-column: 4 / 7; }
    .manage-interviews-action { grid-column: 7 / 10; }
    .analytics-action { grid-column: 10 / 13; }
    
    .recent-applications { grid-column: 1 / 7; }
    .job-management { grid-column: 7 / 13; }
    
    .performance-metrics { grid-column: 1 / 13; }
}

@media (max-width: 768px) {
    .hr-bento {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(14, minmax(75px, auto));
        gap: 6px;
    }
    
    .bento-item {
        padding: 0.6rem;
        min-height: 70px;
    }
    
    .hr-header { grid-column: 1 / 5; grid-row: 1 / 2; }
    .hr-quick-stats { grid-column: 1 / 5; grid-row: 2 / 3; }
    
    .jobs-stat { grid-column: 1 / 2; grid-row: 3 / 4; }
    .applications-stat { grid-column: 2 / 3; grid-row: 3 / 4; }
    .pending-stat { grid-column: 3 / 4; grid-row: 3 / 4; }
    .interviews-stat { grid-column: 4 / 5; grid-row: 3 / 4; }
    .candidates-stat { grid-column: 1 / 5; grid-row: 4 / 5; }
    
    .post-job-action { grid-column: 1 / 5; grid-row: 5 / 6; }
    .view-applications-action { grid-column: 1 / 5; grid-row: 6 / 7; }
    .manage-interviews-action { grid-column: 1 / 5; grid-row: 7 / 8; }
    .analytics-action { grid-column: 1 / 5; grid-row: 8 / 9; }
    
    .recent-applications { grid-column: 1 / 5; grid-row: 9 / 11; }
    .job-management { grid-column: 1 / 5; grid-row: 11 / 13; }
    .performance-metrics { grid-column: 1 / 5; grid-row: 13 / 15; }
}

@media (max-width: 480px) {
    .hr-bento {
        grid-template-columns: 1fr;
        gap: 4px;
    }
    
    .bento-item {
        grid-column: 1 !important;
        grid-row: auto !important;
        min-height: 65px;
        padding: 0.5rem;
    }
}

/* Typography and UI Elements */
.stat-number {
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 0.2rem;
    color: #2d3748;
    line-height: 1.1;
}

.stat-label {
    font-size: 0.75rem;
    opacity: 0.8;
    margin: 0;
    color: #4a5568;
    font-weight: 500;
    line-height: 1.2;
}

.action-icon {
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
    opacity: 0.7;
    color: #4a5568;
}

.bento-item .btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 6px;
    font-weight: 500;
}

.bento-item h5 {
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
    font-weight: 600;
    line-height: 1.2;
}

.bento-item .small {
    font-size: 0.7rem;
    margin-bottom: 0.5rem;
    opacity: 0.8;
    line-height: 1.2;
}

.activity-list {
    max-height: 180px;
    overflow-y: auto;
    width: 100%;
}

.activity-list::-webkit-scrollbar {
    width: 3px;
}

.activity-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 2px;
}

.activity-list::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
}

.activity-item {
    background: rgba(255,255,255,0.3);
    border-radius: 6px;
    padding: 0.5rem;
    margin-bottom: 0.3rem;
    transition: all 0.15s ease;
    border: 1px solid rgba(0, 0, 0, 0.03);
    font-size: 0.8rem;
    cursor: pointer;
}

.activity-item:hover {
    background: rgba(255,255,255,0.5);
    transform: translateX(3px);
    border-color: rgba(0, 0, 0, 0.08);
}

.stat-number.loading {
    opacity: 0.5;
    transition: opacity 0.3s ease;
}

.fa-spin {
    animation: fa-spin 1s infinite linear;
}

@keyframes fa-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Quick Actions Compact Design */
.quick-actions-compact {
    background: rgba(248, 249, 250, 0.8);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.quick-actions-compact .btn {
    padding: 0.4rem 0.8rem;
    margin: 0.2rem;
    font-size: 0.75rem;
    border-radius: 6px;
}

/* Performance Metrics Styling */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    width: 100%;
}

.metric-item {
    background: rgba(255,255,255,0.4);
    border-radius: 6px;
    padding: 0.8rem;
    text-align: center;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.metric-value {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.3rem;
}

.metric-label {
    font-size: 0.7rem;
    color: #4a5568;
    opacity: 0.8;
}

.progress-bar {
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 2px;
    transition: width 0.5s ease;
}
</style>

<div class="hr-bento">
    <!-- HR Header -->
    <div class="bento-item hr-header">
        <div class="w-100">
            <div class="d-flex justify-content-between align-items-center mb-1">
                <h4 class="mb-0 fw-bold">
                    <i class="fas fa-building me-2"></i>HR Dashboard
                </h4>
                <button class="btn btn-sm btn-outline-primary" onclick="forceRefreshHR()" title="Refresh Data">
                    <i class="fas fa-sync-alt" id="hrRefreshIcon"></i>
                </button>
            </div>
            <p class="mb-1">Talent Acquisition & Management Hub</p>
            <div class="d-flex align-items-center gap-3 mt-1">
                <small class="text-success">
                    <i class="fas fa-circle me-1" style="font-size: 0.4rem;"></i>
                    Real-time monitoring
                </small>
                <small class="text-muted" id="hrLastUpdated">Loading...</small>
            </div>
        </div>
    </div>

    <!-- Quick Stats Summary -->
    <div class="bento-item hr-quick-stats">
        <i class="fas fa-chart-pie action-icon"></i>
        <h5 class="mb-2">System Health</h5>
        <div id="systemHealth" class="stat-number text-success">98%</div>
        <p class="stat-label">Operational</p>
    </div>

    <!-- Main Statistics Row -->
    <div class="bento-item jobs-stat">
        <i class="fas fa-briefcase action-icon"></i>
        <div class="stat-number" id="totalJobs">0</div>
        <p class="stat-label">Active Jobs</p>
    </div>

    <div class="bento-item applications-stat">
        <i class="fas fa-user-check action-icon"></i>
        <div class="stat-number" id="totalApplications">0</div>
        <p class="stat-label">Total Applications</p>
    </div>

    <div class="bento-item pending-stat">
        <i class="fas fa-clock action-icon text-warning"></i>
        <div class="stat-number text-warning" id="pendingReviews">0</div>
        <p class="stat-label">Pending Reviews</p>
    </div>

    <div class="bento-item interviews-stat">
        <i class="fas fa-calendar-check action-icon text-info"></i>
        <div class="stat-number text-info" id="scheduledInterviews">0</div>
        <p class="stat-label">Scheduled Interviews</p>
    </div>

    <div class="bento-item candidates-stat">
        <i class="fas fa-star action-icon text-warning"></i>
        <div class="stat-number text-warning" id="topCandidates">0</div>
        <p class="stat-label">Top Candidates</p>
    </div>

    <!-- Action Items Row -->
    <div class="bento-item post-job-action" onclick="openJobPostingModal()">
        <i class="fas fa-plus-circle action-icon text-primary"></i>
        <h5 class="mb-2">Post New Job</h5>
        <p class="small mb-3">Create job listings with AI assistance</p>
        <button class="btn btn-primary btn-sm">
            <i class="fas fa-plus me-1"></i>Create
        </button>
    </div>

    <div class="bento-item view-applications-action" onclick="viewApplications()">
        <i class="fas fa-users action-icon text-success"></i>
        <h5 class="mb-2">View Applications</h5>
        <p class="small mb-3">Review and manage candidate applications</p>
        <button class="btn btn-success btn-sm">
            <i class="fas fa-eye me-1"></i>Review
        </button>
    </div>

    <div class="bento-item manage-interviews-action" onclick="openInterviewManagement()">
        <i class="fas fa-calendar-alt action-icon text-warning"></i>
        <h5 class="mb-2">Manage Interviews</h5>
        <p class="small mb-3">Schedule and track interview processes</p>
        <button class="btn btn-warning btn-sm">
            <i class="fas fa-calendar me-1"></i>Schedule
        </button>
    </div>

    <div class="bento-item analytics-action" onclick="generateReport()">
        <i class="fas fa-chart-bar action-icon text-info"></i>
        <h5 class="mb-2">Analytics & Reports</h5>
        <p class="small mb-3">Generate insights and performance reports</p>
        <button class="btn btn-info btn-sm">
            <i class="fas fa-download me-1"></i>Generate
        </button>
    </div>

    <!-- Recent Applications -->
    <div class="bento-item recent-applications">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-inbox me-2 text-primary"></i>
                <h5 class="mb-0">Recent Applications</h5>
            </div>
            <div class="activity-list" id="recentApplications">
                <p class="text-muted text-center">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Job Management -->
    <div class="bento-item job-management">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-tasks me-2 text-success"></i>
                <h5 class="mb-0">Active Jobs</h5>
            </div>
            <div class="activity-list" id="activeJobs">
                <p class="text-muted text-center">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="bento-item performance-metrics">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-chart-line me-2 text-info"></i>
                <h5 class="mb-0">Performance Metrics</h5>
            </div>
            <div class="metrics-grid" id="performanceMetrics">
                <div class="metric-item">
                    <div class="metric-value" id="applicationRate">0%</div>
                    <div class="metric-label">Application Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="applicationRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="interviewRate">0%</div>
                    <div class="metric-label">Interview Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="interviewRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="hireRate">0%</div>
                    <div class="metric-label">Hire Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="hireRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="avgTimeToHire">0</div>
                    <div class="metric-label">Avg Days to Hire</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compact Quick Actions -->
<div class="quick-actions-compact">
    <div class="d-flex flex-wrap justify-content-center gap-1">
        <button class="btn btn-outline-primary btn-sm" onclick="loadHRJobs()">
            <i class="fas fa-list me-1"></i>All Jobs
        </button>
        <button class="btn btn-outline-success btn-sm" onclick="loadRecentApplications()">
            <i class="fas fa-users me-1"></i>Applications
        </button>
        <button class="btn btn-outline-warning btn-sm" onclick="loadInterviewSchedule()">
            <i class="fas fa-calendar me-1"></i>Interviews
        </button>
        <button class="btn btn-outline-info btn-sm" onclick="loadJobMetrics()">
            <i class="fas fa-chart-bar me-1"></i>Analytics
        </button>
        <button class="btn btn-outline-secondary btn-sm" onclick="exportHRReport()">
            <i class="fas fa-download me-1"></i>Export
        </button>
        <button class="btn btn-outline-dark btn-sm" onclick="forceRefreshHR()">
            <i class="fas fa-sync-alt me-1"></i>Refresh
        </button>
    </div>
    <div class="text-center mt-2">
        <small class="text-muted">
            <i class="fas fa-clock me-1"></i>
            <span id="hrLastUpdatedFooter">Loading...</span>
        </small>
    </div>
</div>

<!-- Job Posting Modal -->
<div class="modal fade" id="jobPostingModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Post New Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="jobPostingForm" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" name="title" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="company" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" name="min_salary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" name="max_salary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" name="description" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" name="requirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitJobPosting()">Post Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Applications Modal -->
<div class="modal fade" id="applicationsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Applications</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="jobFilter">
                            <option value="">All Jobs</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="statusFilter">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="reviewing">Reviewing</option>
                            <option value="interview">Interview</option>
                            <option value="hired">Hired</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="applicantSearch" placeholder="Search applicants...">
                    </div>
                </div>
                <div id="applicationsTable"></div>
                <div id="applicationsPagination" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

<!-- HR Job Management Section -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Job Management</h5>
            <div class="btn-group">
                <button class="btn btn-outline-primary btn-sm" onclick="loadHRJobs()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createJobModal">
                    <i class="fas fa-plus me-1"></i>Add New Job
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Job Filters -->
        <div class="row mb-3">
            <div class="col-md-3">
                <select id="hrJobStatusFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="all">All Status</option>
                    <option value="active" selected>Active Jobs</option>
                    <option value="inactive">Inactive Jobs</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="hrJobCategoryFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="hrJobDateFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="all">All Time</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="30d" selected>Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="input-group input-group-sm">
                    <input type="text" id="hrJobSearch" class="form-control" placeholder="Search jobs...">
                    <button class="btn btn-outline-secondary" type="button" onclick="loadHRJobs()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Jobs Table -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAllJobs" class="form-check-input">
                        </th>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Applications</th>
                        <th>Created</th>
                        <th>Last Activity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="hrJobsTable">
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions -->
        <div class="d-flex justify-content-between mt-3">
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="bulkActionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Bulk Actions
                </button>
                <ul class="dropdown-menu" aria-labelledby="bulkActionDropdown">
                    <li><a class="dropdown-item" href="#" onclick="bulkJobStatusChange(true)">Activate Selected</a></li>
                    <li><a class="dropdown-item" href="#" onclick="bulkJobStatusChange(false)">Deactivate Selected</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" onclick="bulkCategoryChange()">Change Category</a></li>
                </ul>
            </div>
            
            <!-- Pagination -->
            <nav aria-label="Jobs pagination">
                <ul class="pagination pagination-sm mb-0" id="hrJobsPagination">
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Job Metrics and Analytics Section -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Job Performance Analytics</h5>
            <div class="btn-group">
                <select id="metricsTimeRange" class="form-select form-select-sm" onchange="loadJobMetrics()">
                    <option value="7d">Last 7 Days</option>
                    <option value="30d" selected>Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                    <option value="all">All Time</option>
                </select>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="row" id="jobMetricsContainer">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Applications Over Time</h6>
                        <canvas id="applicationsTimeChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Status Breakdown</h6>
                        <canvas id="statusBreakdownChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Category Performance</h6>
                        <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Jobs</th>
                                        <th>Applications</th>
                                        <th>Avg/Job</th>
                                    </tr>
                                </thead>
                                <tbody id="categoryPerformanceTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Top Performing Jobs</h6>
                        <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Job Title</th>
                                        <th>Applications</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="topJobsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Job Modal -->
<div class="modal fade" id="editJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editJobForm" class="needs-validation" novalidate>
                    <input type="hidden" id="editJobId">
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="editJobTitle" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" id="editJobCompany" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="editJobLocation" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" id="editJobType" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="editJobCategory" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" id="editMinSalary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" id="editMaxSalary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" id="editJobDescription" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" id="editJobRequirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateHRJob()">Update Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Job Modal -->
<div class="modal fade" id="createJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createJobForm" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" name="title" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="company" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" name="min_salary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" name="max_salary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" name="description" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" name="requirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createHRJob()">Create Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Interview Scheduling Modal -->
<div class="modal fade" id="scheduleInterviewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Schedule Interview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="scheduleInterviewForm">
                    <input type="hidden" id="interviewApplicationId" name="application_id">
                    
                    <!-- Candidate Info -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Candidate</label>
                            <div class="p-2 bg-light rounded" id="candidateInfo">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Position</label>
                            <div class="p-2 bg-light rounded" id="positionInfo">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interview Details -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="interviewType" class="form-label">Interview Type</label>
                            <select class="form-select" id="interviewType" name="interview_type" required>
                                <option value="phone">Phone Interview</option>
                                <option value="video">Video Interview</option>
                                <option value="technical" selected>Technical Interview</option>
                                <option value="hr">HR Interview</option>
                                <option value="final">Final Interview</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewTitle" class="form-label">Interview Title</label>
                            <input type="text" class="form-control" id="interviewTitle" name="title" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="interviewDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="interviewDescription" name="description" rows="3" placeholder="Interview agenda, topics to cover, etc."></textarea>
                    </div>
                    
                    <!-- Scheduling -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="interviewDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="interviewDate" name="interview_date" required>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewTime" class="form-label">Time</label>
                            <input type="time" class="form-control" id="interviewTime" name="interview_time" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="duration" class="form-label">Duration (minutes)</label>
                            <select class="form-select" id="duration" name="duration_minutes">
                                <option value="30">30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewLocation" class="form-label">Location/Room</label>
                            <input type="text" class="form-control" id="interviewLocation" name="location" placeholder="Conference Room A, Zoom, etc.">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="meetingLink" class="form-label">Meeting Link (for video interviews)</label>
                        <input type="url" class="form-control" id="meetingLink" name="meeting_link" placeholder="https://zoom.us/j/...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitInterviewSchedule()">Schedule Interview</button>
            </div>
        </div>
    </div>
</div>

<!-- Interview Management Modal -->
<div class="modal fade" id="interviewManagementModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Interview Management</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Filters and Actions -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="interviewStatusFilter" onchange="loadInterviews()">
                            <option value="">All Statuses</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="interviewTypeFilter" onchange="loadInterviews()">
                            <option value="">All Types</option>
                            <option value="phone">Phone</option>
                            <option value="video">Video</option>
                            <option value="technical">Technical</option>
                            <option value="hr">HR</option>
                            <option value="final">Final</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="date" class="form-control form-control-sm" id="interviewDateFrom" onchange="loadInterviews()">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control form-control-sm" id="interviewDateTo" onchange="loadInterviews()">
                        </div>
                    </div>
                </div>
                
                <!-- Interviews Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Candidate & Position</th>
                                <th>Type</th>
                                <th>Title</th>
                                <th>Scheduled</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="interviewsTableBody">
                            <!-- Will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav id="interviewsPagination" aria-label="Interviews pagination">
                    <!-- Will be populated dynamically -->
                </nav>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
// Global variables for HR dashboard
let hrRefreshInterval;
let hrLastUpdateTime = 0;

// Helper function to get auth headers
function getAuthHeaders() {
    const token = localStorage.getItem('token');
    return token ? { 'Authorization': `Bearer ${token}` } : {};
}

// Helper function to show alerts
function showAlert(message, type = 'info', duration = 5000) {
    // Remove existing alerts
    const existingAlerts = document.querySelectorAll('.alert-floating');
    existingAlerts.forEach(alert => alert.remove());
    
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed alert-floating`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    if (duration > 0) {
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, duration);
    }
}

// Helper functions for loading states
function showLoadingState() {
    const loadingElements = document.querySelectorAll('.stat-number');
    loadingElements.forEach(el => {
        if (!el.classList.contains('loading')) {
            el.classList.add('loading');
            el.textContent = '...';
        }
    });
}

function hideLoadingState() {
    const loadingElements = document.querySelectorAll('.stat-number.loading');
    loadingElements.forEach(el => {
        el.classList.remove('loading');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
    loadJobsForFilter();
    loadHRJobs();
    loadJobMetrics();
    
    // Setup auto-refresh every 30 seconds for real-time updates
    hrRefreshInterval = setInterval(function() {
        loadDashboardData();
    }, 30000);
    
    // Setup event listeners
    document.getElementById('selectAllJobs')?.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#hrJobsTable input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
    
    // Interview scheduling form submission
    const scheduleInterviewForm = document.getElementById('scheduleInterviewForm');
    if (scheduleInterviewForm) {
        scheduleInterviewForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            await submitInterviewSchedule();
        });
    }
});

async function loadDashboardData() {
    try {
        showLoadingState();
        
        // Load application stats
        const statsResponse = await fetch('/api/jobs/applications/stats/hr', {
            headers: getAuthHeaders()
        });
        
        // Load HR metrics for additional data
        const metricsResponse = await fetch('/api/jobs/hr/metrics?time_range=30d', {
            headers: getAuthHeaders()
        });
        
        let statsData = {};
        let metricsData = {};
        
        if (statsResponse.ok) {
            const result = await statsResponse.json();
            statsData = result.stats || {};
        }
        
        if (metricsResponse.ok) {
            const result = await metricsResponse.json();
            metricsData = result.metrics || {};
        }
        
        // Combine data and update dashboard
        updateDashboardStats(statsData, metricsData);
        
        // Load recent applications and jobs
        await Promise.all([
            loadRecentApplications(),
            loadActiveJobs(),
            loadInterviewSchedule()
        ]);
        
        hideLoadingState();
        updateLastUpdatedIndicator();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        showAlert('Error loading dashboard data', 'danger');
        hideLoadingState();
    }
}

function updateDashboardStats(statsData, metricsData) {
    // Update main stats cards
    updateStatElement('totalJobs', metricsData.total_jobs || 0);
    updateStatElement('totalApplications', statsData.total || 0);
    updateStatElement('pendingReviews', statsData.pending || 0);
    
    // Calculate top candidates (shortlisted + reviewed)
    const topCandidates = (statsData.shortlisted || 0) + (statsData.reviewed || 0);
    updateStatElement('topCandidates', topCandidates);
    
    // Update performance metrics
    updatePerformanceMetrics(statsData, metricsData);
}

function updateStatElement(elementId, value) {
    const element = document.getElementById(elementId);
    if (element && element.textContent !== value.toString()) {
        element.classList.add('loading');
        setTimeout(() => {
            element.textContent = value;
            element.classList.remove('loading');
            
            // Add a subtle animation
            element.style.transform = 'scale(1.1)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }, 150);
    }
}

function updatePerformanceMetrics(statsData, metricsData) {
    const totalJobs = metricsData.total_jobs || 1;
    const totalApplications = statsData.total || 0;
    
    // Calculate rates
    const applicationRate = totalJobs > 0 ? Math.round((totalApplications / totalJobs) * 10) : 0;
    const interviewRate = totalApplications > 0 ? Math.round(((statsData.shortlisted || 0) / totalApplications) * 100) : 0;
    const hireRate = totalApplications > 0 ? Math.round(((statsData.reviewed || 0) / totalApplications) * 100) : 0;
    const avgTimeToHire = metricsData.avg_time_to_hire || 0;
    
    // Update elements
    updateStatElement('applicationRate', Math.min(applicationRate, 100) + '%');
    updateStatElement('interviewRate', interviewRate + '%');
    updateStatElement('hireRate', hireRate + '%');
    updateStatElement('avgTimeToHire', Math.round(avgTimeToHire));
    
    // Update progress bars
    const applicationRateBar = document.getElementById('applicationRateBar');
    const interviewRateBar = document.getElementById('interviewRateBar');
    const hireRateBar = document.getElementById('hireRateBar');
    
    if (applicationRateBar) applicationRateBar.style.width = Math.min(applicationRate, 100) + '%';
    if (interviewRateBar) interviewRateBar.style.width = interviewRate + '%';
    if (hireRateBar) hireRateBar.style.width = hireRate + '%';
}

async function loadRecentApplications() {
    try {
        const response = await fetch('/api/jobs/applications/recent', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const applications = result.applications || [];
            displayRecentApplications(applications);
        } else {
            document.getElementById('recentApplications').innerHTML = 
                '<div class="text-center py-4"><p class="text-muted">No recent applications found</p></div>';
        }
    } catch (error) {
        console.error('Error loading recent applications:', error);
        document.getElementById('recentApplications').innerHTML = 
            '<div class="text-center py-4"><p class="text-danger">Error loading applications</p></div>';
    }
}

function displayRecentApplications(applications) {
    const container = document.getElementById('recentApplications');
    if (!container) return;
    
    if (!applications || applications.length === 0) {
        container.innerHTML = '<div class="text-center py-4"><p class="text-muted">No recent applications</p></div>';
        return;
    }
    
    container.innerHTML = applications.slice(0, 5).map(app => `
        <div class="activity-item" onclick="viewApplicationDetails(${app.id})">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>${app.resume?.name || app.candidate_name || 'Unknown'}</strong>
                    <br>
                    <small class="text-muted">
                        ${app.job?.title || app.job_title || 'Unknown Position'}  
                        <span class="badge bg-${getStatusColor(app.status)} text-white">
                            ${app.status || 'pending'}
                        </span>
                    </small>
                </div>
                <div class="d-flex align-items-center gap-2">
                    ${typeof app.match_score === 'number' ? 
                        `<div class="text-center">
                            <div class="small text-muted">Match</div>
                            <div class="fw-bold text-${app.match_score >= 80 ? 'success' : app.match_score >= 60 ? 'warning' : 'danger'}">
                                ${Math.round(app.match_score)}%
                            </div>
                        </div>` : ''
                    }
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </div>
    `).join('');
}

async function loadActiveJobs() {
    try {
        const response = await fetch('/api/jobs/hr?status=active&per_page=5', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const jobs = result.jobs || [];
            displayActiveJobs(jobs);
        } else {
            document.getElementById('activeJobs').innerHTML = 
                '<div class="text-center py-4"><p class="text-muted">No active jobs found</p></div>';
        }
    } catch (error) {
        console.error('Error loading active jobs:', error);
        document.getElementById('activeJobs').innerHTML = 
            '<div class="text-center py-4"><p class="text-danger">Error loading jobs</p></div>';
    }
}

function displayActiveJobs(jobs) {
    const container = document.getElementById('activeJobs');
    if (!container) return;
    
    if (!jobs || jobs.length === 0) {
        container.innerHTML = '<div class="text-center py-4"><p class="text-muted">No active jobs</p></div>';
        return;
    }
    
    container.innerHTML = jobs.slice(0, 5).map(job => `
        <div class="activity-item" onclick="editJob(${job.id})">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>${job.title}</strong>
                    <br>
                    <small class="text-muted">
                        ${job.company}  ${job.location}  
                        <span class="badge bg-success">Active</span>
                    </small>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <div class="text-center">
                        <div class="small text-muted">Applications</div>
                        <div class="fw-bold text-primary">${job.application_count || 0}</div>
                    </div>
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </div>
    `).join('');
}

async function loadInterviewSchedule() {
    try {
        const response = await fetch('/api/interviews/upcoming', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const interviews = result.interviews || [];
            updateStatElement('scheduledInterviews', interviews.length);
        }
    } catch (error) {
        console.error('Error loading interview schedule:', error);
    }
}

function getStatusColor(status) {
    if (!status) return 'secondary';
    
    switch (status.toLowerCase()) {
        case 'accepted': 
        case 'hired': return 'success';
        case 'rejected': return 'danger';
        case 'pending': return 'warning';
        case 'interview': 
        case 'interviewing': return 'info';
        case 'withdrawn': return 'dark';
        case 'reviewing': return 'primary';
        default: return 'secondary';
    }
}

function forceRefreshHR() {
    const refreshIcon = document.getElementById('hrRefreshIcon');
    if (refreshIcon) {
        refreshIcon.classList.add('fa-spin');
    }
    
    loadDashboardData().finally(() => {
        if (refreshIcon) {
            refreshIcon.classList.remove('fa-spin');
        }
    });
}

function updateLastUpdatedIndicator() {
    const now = new Date();
    const timeString = now.toLocaleTimeString();
    
    const lastUpdatedElements = ['hrLastUpdated', 'hrLastUpdatedFooter'];
    lastUpdatedElements.forEach(elementId => {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = `Last updated: ${timeString}`;
        }
    });
    
    hrLastUpdateTime = Date.now();
}

// Action functions
function openJobPostingModal() {
    const modal = new bootstrap.Modal(document.getElementById('jobPostingModal'));
    modal.show();
}

function viewApplications() {
    const modal = new bootstrap.Modal(document.getElementById('applicationsModal'));
    modal.show();
    // Load applications data when modal opens
    loadApplicationsTable();
}

function openInterviewManagement() {
    // Navigate to interview management page or open modal
    window.location.href = '/hr/interviews';
}

function generateReport() {
    showAlert('Generating comprehensive HR report...', 'info');
    // Implement report generation logic
    setTimeout(() => {
        showAlert('Report generated successfully!', 'success');
    }, 2000);
}

function exportHRReport() {
    showAlert('Exporting HR data...', 'info');
    // Implement export functionality
    setTimeout(() => {
        showAlert('HR report exported to Downloads folder', 'success');
    }, 1500);
}

// Job management functions
async function submitJobPosting() {
    const form = document.getElementById('jobPostingForm');
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }
    
    const formData = new FormData(form);
    const jobData = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch('/api/jobs/', {
            method: 'POST',
            headers: {
                ...getAuthHeaders(),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(jobData)
        });
        
        if (response.ok) {
            showAlert('Job posted successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('jobPostingModal')).hide();
            form.reset();
            form.classList.remove('was-validated');
            loadDashboardData();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Failed to post job', 'danger');
        }
    } catch (error) {
        console.error('Error posting job:', error);
        showAlert('Error posting job', 'danger');
    }
}

async function loadApplicationsTable() {
    // Implementation for loading applications table
    // This would populate the applications modal with data
    try {
        const response = await fetch('/api/jobs/applications/all', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            // Populate applications table
            displayApplicationsTable(result.applications || []);
        }
    } catch (error) {
        console.error('Error loading applications:', error);
    }
}

function displayApplicationsTable(applications) {
    const container = document.getElementById('applicationsTable');
    if (!container) return;
    
    // Create comprehensive table view of all applications
    if (!applications || applications.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No applications found</div>';
        return;
    }
    
    const table = `
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Candidate</th>
                        <th>Job Position</th>
                        <th>Status</th>
                        <th>Applied Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${applications.map(app => `
                        <tr>
                            <td>
                                <div class="fw-bold">${app.candidate_name || 'Unknown'}</div>
                                <small class="text-muted">${app.candidate_email || ''}</small>
                            </td>
                            <td>${app.job_title || 'Unknown Position'}</td>
                            <td>
                                <span class="badge bg-${getStatusColor(app.status)}">
                                    ${app.status || 'Pending'}
                                </span>
                            </td>
                            <td>${formatDate(app.applied_at || app.created_at)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewApplicationDetails(${app.id})">
                                    View
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
    container.innerHTML = table;
}

async function viewApplicationDetails(applicationId) {
    try {
        showAlert('Loading application details...', 'info', 1000);
        
        const response = await fetch(`/api/jobs/applications/${applicationId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const application = await response.json();
            // Show application details modal or navigate to details page
            showApplicationDetailsModal(application);
        } else {
            showAlert('Could not load application details', 'danger');
        }
    } catch (error) {
        console.error('Error loading application details:', error);
        showAlert('Error loading application details', 'danger');
    }
}

function showApplicationDetailsModal(application) {
    // Create modal with comprehensive application data
    const modalContent = `
        <div class="modal fade" id="applicationDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Application Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Candidate Information</h6>
                                <p><strong>Name:</strong> ${application.candidate_name || 'N/A'}</p>
                                <p><strong>Email:</strong> ${application.candidate_email || 'N/A'}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Position Information</h6>
                                <p><strong>Job Title:</strong> ${application.job_title || 'N/A'}</p>
                                <p><strong>Company:</strong> ${application.company || 'N/A'}</p>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <h6>Application Status</h6>
                                <p><strong>Status:</strong> <span class="badge bg-${getStatusColor(application.status)}">${application.status || 'Pending'}</span></p>
                                <p><strong>Applied Date:</strong> ${formatDate(application.applied_at || application.created_at)}</p>
                                ${application.match_score ? `<p><strong>Match Score:</strong> ${Math.round(application.match_score)}%</p>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if present
    const existingModal = document.getElementById('applicationDetailsModal');
    if (existingModal) existingModal.remove();
    
    // Add new modal and show it
    document.body.insertAdjacentHTML('beforeend', modalContent);
    const modal = new bootstrap.Modal(document.getElementById('applicationDetailsModal'));
    modal.show();
}

async function editJob(jobId) {
    try {
        const response = await fetch(`/api/jobs/${jobId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const job = await response.json();
            populateEditJobForm(job);
            const modal = new bootstrap.Modal(document.getElementById('editJobModal'));
            modal.show();
        } else {
            showAlert('Could not load job details', 'danger');
        }
    } catch (error) {
        console.error('Error loading job details:', error);
        showAlert('Error loading job details', 'danger');
    }
}

function populateEditJobForm(job) {
    document.getElementById('editJobId').value = job.id;
    document.getElementById('editJobTitle').value = job.title;
    document.getElementById('editJobCompany').value = job.company;
    document.getElementById('editJobLocation').value = job.location;
    document.getElementById('editJobType').value = job.type;
    document.getElementById('editJobCategory').value = job.category;
    document.getElementById('editMinSalary').value = job.min_salary || '';
    document.getElementById('editMaxSalary').value = job.max_salary || '';
    document.getElementById('editJobDescription').value = job.description;
    document.getElementById('editJobRequirements').value = job.requirements;
}

// Additional utility functions for the HR dashboard
async function loadJobsForFilter() {
    try {
        const response = await fetch('/api/jobs/', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const jobs = result.jobs || [];
            
            const jobFilter = document.getElementById('jobFilter');
            if (jobFilter) {
                jobFilter.innerHTML = '<option value="">All Jobs</option>' + 
                    jobs.map(job => `<option value="${job.id}">${job.title}</option>`).join('');
            }
        }
    } catch (error) {
        console.error('Error loading jobs for filter:', error);
    }
}

async function loadHRJobs() {
    // Load HR jobs table - this populates the jobs management section
    try {
        const response = await fetch('/api/jobs/hr', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const jobs = result.jobs || [];
            console.log('HR Jobs loaded:', jobs.length);
            // Jobs will be displayed in the job management section
        }
    } catch (error) {
        console.error('Error loading HR jobs:', error);
    }
}

async function loadJobMetrics() {
    // Load job performance metrics - this updates the analytics charts and metrics
    try {
        const response = await fetch('/api/jobs/hr/metrics', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('Job metrics loaded:', result);
            // Metrics will be used to update dashboard charts
        }
    } catch (error) {
        console.error('Error loading job metrics:', error);
    }
}

// Cleanup function
window.addEventListener('beforeunload', function() {
    if (hrRefreshInterval) {
        clearInterval(hrRefreshInterval);
    }
});

function getStatusColor(status) {
    switch(status?.toLowerCase()) {
        case 'hired': 
        case 'approved': return 'success';
        case 'rejected': return 'danger';
        case 'interview': return 'info';
        case 'reviewing': return 'primary';
        default: return 'warning';
    }
}

function formatDate(dateString) {
    if (!dateString) return 'Unknown';
    const date = new Date(dateString);
    return date.toLocaleDateString();
}

function refreshDashboard() {
    showAlert('Refreshing dashboard...', 'info');
    loadDashboardData();
    loadHRJobs();
    loadJobMetrics();
}

function viewApplications() {
    const modal = new bootstrap.Modal(document.getElementById('applicationsModal'));
    modal.show();
    loadApplications();
}

function generateReport() {
    showAlert('Report generation feature coming soon!', 'info');
}

function openJobPostingModal() {
    const modal = new bootstrap.Modal(document.getElementById('jobPostingModal'));
    modal.show();
}

async function submitJobPosting() {
    const form = document.getElementById('jobPostingForm');
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }

    const formData = new FormData(form);
    const jobData = Object.fromEntries(formData.entries());
    
    // Convert salary fields to numbers
    if (jobData.min_salary) jobData.min_salary = Number(jobData.min_salary);
    if (jobData.max_salary) jobData.max_salary = Number(jobData.max_salary);
    
    // Parse requirements as an array if comma-separated
    if (jobData.requirements && typeof jobData.requirements === 'string') {
        jobData.requirements = jobData.requirements
            .split(',')
            .map(req => req.trim())
            .filter(req => req);
    }
    
    try {
        const response = await fetch('/api/jobs', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify(jobData)
        });
        
        if (response.ok) {
            showAlert('Job posted successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('jobPostingModal')).hide();
            form.reset();
            loadDashboardData();
            loadHRJobs();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Error posting job', 'danger');
        }
    } catch (error) {
        console.error('Error posting job:', error);
        showAlert('Error posting job', 'danger');
    }
}

async function loadJobsForFilter() {
    try {
        const response = await fetch('/api/jobs/hr', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            const select = document.getElementById('jobFilter');
            if (select) {
                select.innerHTML = '<option value="">All Jobs</option>' +
                    data.jobs.map(job => `
                        <option value="${job.id}">${job.title} - ${job.company}</option>
                    `).join('');
            }
            
            // Also populate category filter
            const categorySelect = document.getElementById('hrJobCategoryFilter');
            if (categorySelect && data.filters && data.filters.categories) {
                categorySelect.innerHTML = '<option value="">All Categories</option>' +
                    data.filters.categories.map(category => 
                        `<option value="${category}">${category}</option>`
                    ).join('');
            }
        }
    } catch (error) {
        console.error('Error loading jobs for filter:', error);
    }
}

async function loadApplications(page = 1) {
    const jobId = document.getElementById('jobFilter')?.value;
    const status = document.getElementById('statusFilter')?.value;
    const search = document.getElementById('applicantSearch')?.value;
    
    try {
        const queryParams = new URLSearchParams({
            page,
            per_page: 10
        });
        
        if (jobId) queryParams.append('job_id', jobId);
        if (status) queryParams.append('status', status);
        if (search) queryParams.append('search', search);
        
        const response = await fetch(`/api/jobs/hr/applications?${queryParams}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            displayApplications(data.applications, data.pagination);
        } else {
            document.getElementById('applicationsTable').innerHTML = `
                <div class="alert alert-danger">
                    Error loading applications
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading applications:', error);
        document.getElementById('applicationsTable').innerHTML = `
            <div class="alert alert-danger">
                Error loading applications
            </div>
        `;
    }
}

function displayApplications(applications, pagination) {
    const container = document.getElementById('applicationsTable');
    
    if (!applications || applications.length === 0) {
        container.innerHTML = `
            <div class="alert alert-info">
                No applications found
            </div>
        `;
        return;
    }
    
    const table = `
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Applicant</th>
                        <th>Job</th>
                        <th>Match Score</th>
                        <th>Status</th>
                        <th>Applied</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${applications.map(app => `
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                        <i class="fas fa-user text-primary"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold">${app.candidate?.name || 'Unknown'}</div>
                                        <small class="text-muted">${app.candidate?.email || ''}</small>
                                    </div>
                                </div>
                            </td>
                            <td>${app.job?.title || 'Unknown'}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                        <div class="progress-bar bg-success" style="width: ${Math.round((app.match_score || 0) * 100)}%"></div>
                                    </div>
                                    <span class="small">${Math.round((app.match_score || 0) * 100)}%</span>
                                </div>
                            </td>
                            <td>
                                <select class="form-select form-select-sm w-auto" 
                                        onchange="updateApplicationStatus(${app.id}, this.value)">
                                    <option value="pending" ${app.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="reviewing" ${app.status === 'reviewing' ? 'selected' : ''}>Reviewing</option>
                                    <option value="interview" ${app.status === 'interview' ? 'selected' : ''}>Interview</option>
                                    <option value="hired" ${app.status === 'hired' ? 'selected' : ''}>Hired</option>
                                    <option value="rejected" ${app.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                                </select>
                            </td>
                            <td>${formatDate(app.created_at)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewResume(${app.resume?.id || 0})">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="scheduleInterview(${app.id})">
                                    <i class="fas fa-calendar-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
    
    container.innerHTML = table;
    
    // Add pagination
    const paginationContainer = document.getElementById('applicationsPagination');
    if (pagination && pagination.pages > 1) {
        paginationContainer.innerHTML = `
            <nav>
                <ul class="pagination justify-content-center">
                    <li class="page-item ${!pagination.has_prev ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="loadApplications(${pagination.page - 1}); return false;">Previous</a>
                    </li>
                    ${Array.from({length: pagination.pages}, (_, i) => i + 1).map(p => `
                        <li class="page-item ${p === pagination.page ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadApplications(${p}); return false;">${p}</a>
                        </li>
                    `).join('')}
                    <li class="page-item ${!pagination.has_next ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="loadApplications(${pagination.page + 1}); return false;">Next</a>
                    </li>
                </ul>
            </nav>
        `;
    } else {
        paginationContainer.innerHTML = '';
    }
}

async function updateApplicationStatus(applicationId, status) {
    try {
        const response = await fetch(`/api/jobs/applications/${applicationId}/status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({ status })
        });
        
        if (response.ok) {
            showAlert('Application status updated', 'success');
            loadDashboardData();
            loadApplications();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Error updating application status', 'danger');
        }
    } catch (error) {
        console.error('Error updating status:', error);
        showAlert('Error updating application status', 'danger');
    }
}

function viewResume(resumeId) {
    if (!resumeId) {
        showAlert('Resume not available', 'warning');
        return;
    }
    downloadResume(resumeId);
}

function scheduleInterview(applicationId) {
    // Set the application ID in the form
    document.getElementById('interviewApplicationId').value = applicationId;
    
    // Load application details to populate form
    loadApplicationForInterview(applicationId);
}

async function loadApplicationForInterview(applicationId) {
    try {
        const response = await fetch(`/api/jobs/application/${applicationId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                // Pre-fill some interview details based on application
                const app = data.application;
                document.getElementById('interviewTitle').value = `Interview for ${app.job_title}`;
                
                // Populate candidate and position info
                document.getElementById('candidateInfo').innerHTML = `
                    <div class="fw-bold">${app.candidate_name || 'N/A'}</div>
                    <small class="text-muted">${app.candidate_email || ''}</small>
                `;
                
                document.getElementById('positionInfo').innerHTML = `
                    <div class="fw-bold">${app.job_title || 'N/A'}</div>
                    <small class="text-muted">${app.company || ''}</small>
                `;
                
                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('scheduleInterviewModal'));
                modal.show();
            } else {
                throw new Error(data.message || 'Failed to load application');
            }
        } else {
            throw new Error('Failed to load application');
        }
    } catch (error) {
        console.error('Error loading application:', error);
        showAlert('Error loading application details', 'danger');
        
        // Still show the modal even if we can't load details
        const modal = new bootstrap.Modal(document.getElementById('scheduleInterviewModal'));
        modal.show();
    }
}

// HR Job Management functions
async function loadHRJobs(page = 1) {
    const status = document.getElementById('hrJobStatusFilter').value;
    const category = document.getElementById('hrJobCategoryFilter').value;
    const dateRange = document.getElementById('hrJobDateFilter').value;
    const search = document.getElementById('hrJobSearch').value;
    
    try {
        const queryParams = new URLSearchParams({
            page,
            per_page: 10
        });
        
        if (status && status !== 'all') queryParams.append('status', status);
        if (category) queryParams.append('category', category);
        if (dateRange && dateRange !== 'all') queryParams.append('date_range', dateRange);
        if (search) queryParams.append('search', search);
        
        const response = await fetch(`/api/jobs/hr?${queryParams}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                displayHRJobs(data.jobs, data.pagination);
                
                // Update category filter options if available
                if (data.filters && data.filters.categories && data.filters.categories.length > 0) {
                    const categoryFilter = document.getElementById('hrJobCategoryFilter');
                    categoryFilter.innerHTML = '<option value="">All Categories</option>' + 
                        data.filters.categories.map(cat => 
                            `<option value="${cat}" ${category === cat ? 'selected' : ''}>${cat}</option>`
                        ).join('');
                }
            } else {
                throw new Error(data.message || 'Failed to load job data');
            }
        } else {
            document.getElementById('hrJobsTable').innerHTML = `
                <tr>
                    <td colspan="7" class="text-center py-4">
                        <div class="alert alert-danger mb-0">
                            Error loading jobs
                        </div>
                    </td>
                </tr>
            `;
        }
    } catch (error) {
        console.error('Error loading HR jobs:', error);
        document.getElementById('hrJobsTable').innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="alert alert-danger mb-0">
                        Error loading jobs: ${error.message}
                    </div>
                </td>
            </tr>
        `;
    }
}

function displayHRJobs(jobs, pagination) {
    const container = document.getElementById('hrJobsTable');
    
    if (!jobs || jobs.length === 0) {
        container.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="alert alert-info mb-0">
                        No jobs found
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    container.innerHTML = jobs.map(job => {
        // Calculate application count
        const appCount = job.stats?.total_applications || 0;
        
        // Determine status
        const isActive = job.is_active;
        
        // Format last activity time
        const lastActivity = job.last_activity || job.updated_at || job.created_at;
        
        return `
        <tr>
            <td>
                <input type="checkbox" class="form-check-input job-checkbox" value="${job.id}">
            </td>
            <td>${job.title}</td>
            <td>
                <span class="badge ${isActive ? 'bg-success' : 'bg-secondary'}">
                    ${isActive ? 'Active' : 'Inactive'}
                </span>
            </td>
            <td>
                ${appCount > 0 ? 
                    `<span class="badge bg-info">${appCount}</span>` : 
                    '<span class="text-muted">No applications</span>'}
            </td>
            <td>${formatDate(job.created_at)}</td>
            <td>${formatDate(lastActivity)}</td>
            <td>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" onclick="editJob(${job.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-${isActive ? 'warning' : 'success'}" 
                            onclick="toggleJobStatus(${job.id}, ${!isActive})">
                        <i class="fas fa-${isActive ? 'pause' : 'play'}"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="confirmDeleteJob(${job.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
    `}).join('');
    
    // Update pagination
    updateJobsPagination(pagination);
}

function updateJobsPagination(pagination) {
    const container = document.getElementById('hrJobsPagination');
    
    if (!pagination || !pagination.pages || pagination.pages <= 1) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = `
        <li class="page-item ${pagination.page === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="loadHRJobs(${pagination.page - 1}); return false;">Previous</a>
        </li>
        ${Array.from({ length: pagination.pages }, (_, i) => i + 1).map(p => `
            <li class="page-item ${p === pagination.page ? 'active' : ''}">
                <a class="page-link" href="#" onclick="loadHRJobs(${p}); return false;">${p}</a>
            </li>
        `).join('')}
        <li class="page-item ${pagination.page === pagination.pages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="loadHRJobs(${pagination.page + 1}); return false;">Next</a>
        </li>
    `;
}

async function toggleJobStatus(jobId, activate) {
    try {
        const response = await fetch(`/api/jobs/${jobId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({ is_active: activate })
        });
        
        if (response.ok) {
            showAlert(`Job ${activate ? 'activated' : 'deactivated'} successfully`, 'success');
            loadHRJobs();
        } else {
            const error = await response.json();
            showAlert(error.message || `Error ${activate ? 'activating' : 'deactivating'} job`, 'danger');
        }
    } catch (error) {
        console.error('Error toggling job status:', error);
        showAlert(`Error ${activate ? 'activating' : 'deactivating'} job`, 'danger');
    }
}

async function bulkJobStatusChange(active) {
    const selectedIds = Array.from(document.querySelectorAll('#hrJobsTable input.job-checkbox:checked'))
        .map(checkbox => checkbox.value);
    
    if (selectedIds.length === 0) {
        return showAlert('No jobs selected', 'warning');
    }
    
    const confirmAction = active ? 'activate' : 'deactivate';
    
    if (!confirm(`Are you sure you want to ${confirmAction} the selected jobs?`)) {
        return;
    }
    
    try {
        const response = await fetch('/api/jobs/hr/bulk-action', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({ 
                job_ids: selectedIds, 
                action: active ? 'activate' : 'deactivate'
            })
        });
        
        if (response.ok) {
            showAlert(`Jobs ${confirmAction}d successfully`, 'success');
            loadHRJobs();
        } else {
            const error = await response.json();
            showAlert(error.message || `Error ${confirmAction}ing jobs`, 'danger');
        }
    } catch (error) {
        console.error('Error updating job status:', error);
        showAlert(`Error ${confirmAction}ing jobs`, 'danger');
    }
}

async function bulkCategoryChange() {
    const selectedIds = Array.from(document.querySelectorAll('#hrJobsTable input.job-checkbox:checked'))
        .map(checkbox => checkbox.value);
    
    if (selectedIds.length === 0) {
        return showAlert('No jobs selected', 'warning');
    }
    
    const newCategory = prompt('Enter new category for selected jobs:');
    if (!newCategory) return;
    
    try {
        const response = await fetch('/api/jobs/hr/bulk-action', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({ 
                job_ids: selectedIds, 
                action: 'change_category',
                category: newCategory
            })
        });
        
        if (response.ok) {
            showAlert('Job categories updated successfully', 'success');
            loadHRJobs();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Error updating job categories', 'danger');
        }
    } catch (error) {
        console.error('Error updating job categories:', error);
        showAlert('Error updating job categories', 'danger');
    }
}

function editJob(jobId) {
    // Redirect to edit page or show edit modal
    window.location.href = `/jobs/${jobId}/edit`;
}

function confirmDeleteJob(jobId) {
    if (confirm('Are you sure you want to delete this job? This action cannot be undone.')) {
        deleteJob(jobId);
    }
}

async function deleteJob(jobId) {
    try {
        const response = await fetch(`/api/jobs/${jobId}`, {
            method: 'DELETE',
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            showAlert('Job deleted successfully', 'success');
            loadHRJobs();
            loadDashboardData();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Error deleting job', 'danger');
        }
    } catch (error) {
        console.error('Error deleting job:', error);
        showAlert('Error deleting job', 'danger');
    }
}

async function loadJobMetrics() {
    const timeRange = document.getElementById('metricsTimeRange').value;
    
    try {
        const response = await fetch(`/api/jobs/hr/metrics?time_range=${timeRange}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            updateJobMetricsCharts(data);
        } else {
            const error = await response.json();
            showAlert(error.message || 'Error loading job metrics', 'warning');
            
            // Clear charts
            document.getElementById('jobMetricsContainer').innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-chart-bar text-muted fa-3x mb-3"></i>
                    <h5>No metrics data available</h5>
                    <p class="text-muted">Try changing the time range or adding more jobs</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading job metrics:', error);
        showAlert('Error loading job metrics', 'danger');
    }
}

function updateJobMetricsCharts(data) {
    // Clear existing charts first
    const timeChartCtx = document.getElementById('applicationsTimeChart');
    const statusChartCtx = document.getElementById('statusBreakdownChart');
    
    if (!data) {
        showAlert('No metrics data received from server', 'warning');
        return;
    }
    
    // Applications over time chart
    if (timeChartCtx) {
        const ctx = timeChartCtx.getContext('2d');
        
        // Check if chart instance exists and destroy if it does
        if (window.appTimeChart) {
            window.appTimeChart.destroy();
        }
        
        if (data.applications_over_time && data.applications_over_time.length > 0) {
            const timeData = data.applications_over_time;
            window.appTimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeData.map(item => formatDate(item.date)),
                    datasets: [{
                        label: 'Applications',
                        data: timeData.map(item => item.count),
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12
                            }
                        }
                    }
                }
            });
        }
    }
    
    // Status breakdown chart
    if (statusChartCtx) {
        const ctx = statusChartCtx.getContext('2d');
        
        // Check if chart instance exists and destroy if it does
        if (window.statusChart) {
            window.statusChart.destroy();
        }
        
        if (data.status_breakdown && Object.keys(data.status_breakdown).length > 0) {
            const labels = Object.keys(data.status_breakdown);
            const counts = Object.values(data.status_breakdown);
            
            window.statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
                    datasets: [{
                        data: counts,
                        backgroundColor: [
                            '#28a745', // success
                            '#17a2b8', // info
                            '#ffc107', // warning
                            '#dc3545', // danger
                            '#6c757d'  // secondary
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12
                            }
                        }
                    }
                }
            });
        }
    }
    
    // Update category performance table
    const categoryTableBody = document.getElementById('categoryPerformanceTable');
    if (categoryTableBody && data.category_performance) {
        categoryTableBody.innerHTML = '';
        
        data.category_performance.forEach(category => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${category.name}</td>
                <td>${category.jobs}</td>
                <td>${category.applications}</td>
                <td>${category.average_per_job?.toFixed(1) || '0.0'}</td>
            `;
            categoryTableBody.appendChild(row);
        });
    }
    
    // Update top jobs table
    const topJobsTableBody = document.getElementById('topJobsTable');
    if (topJobsTableBody && data.top_jobs) {
        topJobsTableBody.innerHTML = '';
        
        data.top_jobs.forEach(job => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${job.title}</td>
                <td>${job.applications}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewJob(${job.id})">
                        View
                    </button>
                </td>
            `;
            topJobsTableBody.appendChild(row);
        });
    }
}

function viewJob(jobId) {
    window.location.href = `/jobs/${jobId}`;
}

function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

async function submitInterviewSchedule() {
    const form = document.getElementById('scheduleInterviewForm');
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }

    const formData = new FormData(form);
    const interviewData = Object.fromEntries(formData.entries());
    
    // Convert duration to number
    if (interviewData.duration_minutes) {
        interviewData.duration_minutes = Number(interviewData.duration_minutes);
    }
    
    // Combine date and time into a single datetime
    if (interviewData.interview_date && interviewData.interview_time) {
        const dateTime = `${interviewData.interview_date}T${interviewData.interview_time}`;
        interviewData.scheduled_at = new Date(dateTime).toISOString();
        delete interviewData.interview_date;
        delete interviewData.interview_time;
    }
    
    try {
        const response = await fetch('/api/interviews/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify(interviewData)
        });
        
        if (response.ok) {
            const result = await response.json();
            showAlert('Interview scheduled successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('scheduleInterviewModal')).hide();
            form.reset();
            form.classList.remove('was-validated');
            
            // Refresh applications to show updated status
            loadApplications();
        } else {
            const error = await response.json();
            showAlert(error.error || 'Error scheduling interview', 'danger');
        }
    } catch (error) {
        console.error('Error scheduling interview:', error);
        showAlert('Error scheduling interview', 'danger');
    }
}

// Interview Management Functions
async function loadInterviews() {
    try {
        const statusFilter = document.getElementById('interviewStatusFilter')?.value || '';
        const typeFilter = document.getElementById('interviewTypeFilter')?.value || '';
        const dateFrom = document.getElementById('interviewDateFrom')?.value || '';
        const dateTo = document.getElementById('interviewDateTo')?.value || '';
        
        const queryParams = new URLSearchParams({
            page: 1,
            per_page: 50
        });
        
        if (statusFilter) queryParams.append('status', statusFilter);
        if (typeFilter) queryParams.append('type', typeFilter);
        if (dateFrom) queryParams.append('date_from', dateFrom);
        if (dateTo) queryParams.append('date_to', dateTo);
        
        const response = await fetch(`/api/interviews/?${queryParams}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                displayInterviews(data.interviews);
            } else {
                throw new Error(data.message || 'Failed to load interviews');
            }
        } else {
            throw new Error('Failed to load interviews');
        }
    } catch (error) {
        console.error('Error loading interviews:', error);
        showAlert('Error loading interviews: ' + error.message, 'danger');
    }
}

function displayInterviews(interviews) {
    const tableBody = document.getElementById('interviewsTableBody');
    if (!tableBody) return;
    
    if (!interviews || interviews.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="8" class="text-center py-4">
                    <div class="text-muted">No interviews found</div>
                </td>
            </tr>
        `;
        return;
    }
    
    tableBody.innerHTML = interviews.map(interview => `
        <tr>
            <td>
                <div class="fw-bold">${interview.application?.candidate_name || 'N/A'}</div>
                <small class="text-muted">${interview.application?.job_title || 'N/A'}</small>
            </td>
            <td>
                <span class="badge bg-${getInterviewTypeBadgeColor(interview.interview_type)}">
                    ${interview.interview_type}
                </span>
            </td>
            <td>${interview.title}</td>
            <td>
                <div>${formatDate(interview.scheduled_at)}</div>
                <small class="text-muted">${formatTime(interview.scheduled_at)}</small>
            </td>
            <td>${interview.duration_minutes} min</td>
            <td>
                <span class="badge bg-${getInterviewStatusBadgeColor(interview.status)}">
                    ${interview.status}
                </span>
            </td>
            <td>${interview.location || 'N/A'}</td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewInterview(${interview.id})" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${interview.status === 'scheduled' ? `
                        <button class="btn btn-outline-warning" onclick="editInterview(${interview.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger" onclick="cancelInterview(${interview.id})" title="Cancel">
                            <i class="fas fa-times"></i>
                        </button>
                    ` : ''}
                </div>
            </td>
        </tr>
    `).join('');
}

function getInterviewTypeBadgeColor(type) {
    switch (type) {
        case 'phone': return 'primary';
        case 'video': return 'info';
        case 'technical': return 'warning';
        case 'hr': return 'success';
        case 'final': return 'danger';
        default: return 'secondary';
    }
}

function getInterviewStatusBadgeColor(status) {
    switch (status) {
        case 'scheduled': return 'primary';
        case 'completed': return 'success';
        case 'cancelled': return 'danger';
        case 'rescheduled': return 'warning';
        default: return 'secondary';
    }
}

function formatTime(dateString) {
    if (!dateString) return 'Unknown';
    const date = new Date(dateString);
    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

async function viewInterview(interviewId) {
    try {
        const response = await fetch(`/api/interviews/${interviewId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                showInterviewDetails(data.interview);
            } else {
                throw new Error(data.message || 'Failed to load interview');
            }
        } else {
            throw new Error('Failed to load interview');
        }
    } catch (error) {
        console.error('Error loading interview:', error);
        showAlert('Error loading interview details: ' + error.message, 'danger');
    }
}

function showInterviewDetails(interview) {
    const detailsHtml = `
        <div class="interview-details">
            <h6>Interview Information</h6>
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Candidate:</strong> ${interview.application?.candidate_name || 'N/A'}<br>
                    <strong>Position:</strong> ${interview.application?.job_title || 'N/A'}<br>
                    <strong>Type:</strong> <span class="badge bg-${getInterviewTypeBadgeColor(interview.interview_type)}">${interview.interview_type}</span>
                </div>
                <div class="col-md-6">
                    <strong>Date & Time:</strong> ${formatDate(interview.scheduled_at)} at ${formatTime(interview.scheduled_at)}<br>
                    <strong>Duration:</strong> ${interview.duration_minutes} minutes<br>
                    <strong>Status:</strong> <span class="badge bg-${getInterviewStatusBadgeColor(interview.status)}">${interview.status}</span>
                </div>
            </div>
            <div class="mb-3">
                <strong>Title:</strong> ${interview.title}<br>
                <strong>Description:</strong> ${interview.description || 'No description provided'}
            </div>
            ${interview.location ? `<div class="mb-3"><strong>Location:</strong> ${interview.location}</div>` : ''}
            ${interview.meeting_link ? `<div class="mb-3"><strong>Meeting Link:</strong> <a href="${interview.meeting_link}" target="_blank">${interview.meeting_link}</a></div>` : ''}
            ${interview.feedback ? `<div class="mb-3"><strong>Feedback:</strong> ${interview.feedback}</div>` : ''}
        </div>
    `;
    
    // Create a simple modal to show details
    const modalHtml = `
        <div class="modal fade" id="interviewDetailsModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Interview Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        ${detailsHtml}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if present
    const existingModal = document.getElementById('interviewDetailsModal');
    if (existingModal) existingModal.remove();
    
    // Add new modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('interviewDetailsModal'));
    modal.show();
}

async function cancelInterview(interviewId) {
    if (!confirm('Are you sure you want to cancel this interview?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/interviews/${interviewId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({ status: 'cancelled' })
        });
        
        if (response.ok) {
            showAlert('Interview cancelled successfully', 'success');
            loadInterviews(); // Refresh the list
        } else {
            const error = await response.json();
            showAlert(error.error || 'Error cancelling interview', 'danger');
        }
    } catch (error) {
        console.error('Error cancelling interview:', error);
        showAlert('Error cancelling interview', 'danger');
    }
}

function editInterview(interviewId) {
    // For now, just show a message that edit functionality is coming soon
    showAlert('Interview editing functionality coming soon!', 'info');
}

function openInterviewManagement() {
    const modal = new bootstrap.Modal(document.getElementById('interviewManagementModal'));
    modal.show();
    loadInterviews();
}

// Application details function
async function viewApplicationDetails(applicationId) {
    try {
        const response = await fetch(`/api/jobs/applications/${applicationId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            showApplicationDetailsModal(result.application);
        } else {
            showAlert('Could not load application details', 'danger');
        }
    } catch (error) {
        console.error('Error loading application details:', error);
        showAlert('Error loading application details', 'danger');
    }
}

function showApplicationDetailsModal(application) {
    // Create a modal to show application details
    const modalHtml = `
        <div class="modal fade" id="applicationDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Application Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Candidate Information</h6>
                                <p><strong>Name:</strong> ${application.resume?.name || 'N/A'}</p>
                                <p><strong>Email:</strong> ${application.resume?.email || 'N/A'}</p>
                                <p><strong>Phone:</strong> ${application.resume?.phone || 'N/A'}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Application Details</h6>
                                <p><strong>Position:</strong> ${application.job?.title || 'N/A'}</p>
                                <p><strong>Applied On:</strong> ${new Date(application.created_at).toLocaleDateString()}</p>
                                <p><strong>Status:</strong> 
                                    <span class="badge bg-${getStatusColor(application.status)}">${application.status}</span>
                                </p>
                                ${application.match_score ? `<p><strong>Match Score:</strong> ${Math.round(application.match_score)}%</p>` : ''}
                            </div>
                        </div>
                        ${application.cover_letter ? `
                            <div class="mt-3">
                                <h6>Cover Letter</h6>
                                <p>${application.cover_letter}</p>
                            </div>
                        ` : ''}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" onclick="updateApplicationStatus(${application.id}, 'interviewed')">
                            Schedule Interview
                        </button>
                        <button type="button" class="btn btn-primary" onclick="updateApplicationStatus(${application.id}, 'reviewed')">
                            Mark as Reviewed
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if present
    const existingModal = document.getElementById('applicationDetailsModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to body and show
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('applicationDetailsModal'));
    modal.show();
}

async function updateApplicationStatus(applicationId, newStatus) {
    try {
        const response = await fetch(`/api/jobs/applications/${applicationId}`, {
            method: 'PUT',
            headers: {
                ...getAuthHeaders(),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus })
        });
        
        if (response.ok) {
            showAlert(`Application status updated to ${newStatus}`, 'success');
            // Close modal and refresh data
            bootstrap.Modal.getInstance(document.getElementById('applicationDetailsModal')).hide();
            loadRecentApplications();
        } else {
            showAlert('Failed to update application status', 'danger');
        }
    } catch (error) {
        console.error('Error updating application status:', error);
        showAlert('Error updating application status', 'danger');
    }
}

// Edit job function
function editJob(jobId) {
    showAlert('Job editing functionality coming soon!', 'info');
    // TODO: Implement job editing modal
}
</script>
{% endblock %}
