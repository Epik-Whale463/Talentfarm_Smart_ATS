{% extends "base.html" %}

{% block title %}HR Dashboard - AI-Powered ATS{% endblock %}

{% block content %}
<style>
/* Japanese-inspired Bento Grid Layout for HR Dashboard */
.hr-bento {
    display: grid;
    grid-template-columns: repeat(16, 1fr);
    grid-template-rows: repeat(7, minmax(85px, auto));
    gap: 8px;
    margin-bottom: 1.5rem;
    max-width: 100%;
    padding: 0;
}

.bento-item {
    border-radius: 8px;
    padding: 0.8rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    transition: all 0.15s ease;
    position: relative;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.03);
    box-shadow: 0 1px 4px rgba(0,0,0,0.02);
    backdrop-filter: blur(8px);
    min-height: 80px;
}

.bento-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    border-color: rgba(0, 0, 0, 0.08);
}

/* HR Header Section */
.hr-header {
    grid-column: 1 / 12;
    grid-row: 1 / 2;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    justify-content: flex-start;
    border-left: 2px solid #667eea;
    padding: 1rem;
}

.hr-quick-stats {
    grid-column: 12 / 17;
    grid-row: 1 / 2;
    background: linear-gradient(135deg, rgba(245, 87, 108, 0.08) 0%, rgba(240, 147, 251, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #f55768;
}

/* Main Stats Row */
.jobs-stat {
    grid-column: 1 / 4;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(67, 233, 123, 0.08) 0%, rgba(56, 249, 215, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #43e97b;
}

.applications-stat {
    grid-column: 4 / 7;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(250, 112, 154, 0.08) 0%, rgba(254, 225, 64, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #fa709a;
}

.pending-stat {
    grid-column: 7 / 10;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(255, 154, 158, 0.12) 0%, rgba(254, 207, 239, 0.12) 100%);
    color: #2d3748;
    border-left: 2px solid #ff9a9e;
}

.interviews-stat {
    grid-column: 10 / 13;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.08) 0%, rgba(0, 242, 254, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #4facfe;
}

.candidates-stat {
    grid-column: 13 / 17;
    grid-row: 2 / 3;
    background: linear-gradient(135deg, rgba(161, 140, 209, 0.12) 0%, rgba(251, 194, 235, 0.12) 100%);
    color: #2d3748;
    border-left: 2px solid #a18cd1;
}

/* Action Items Row */
.post-job-action {
    grid-column: 1 / 5;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(168, 237, 234, 0.15) 0%, rgba(254, 214, 227, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #a8edea;
    cursor: pointer;
}

.view-applications-action {
    grid-column: 5 / 9;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(110, 193, 228, 0.15) 0%, rgba(254, 214, 227, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #6ec1e4;
    cursor: pointer;
}

.manage-interviews-action {
    grid-column: 9 / 13;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(250, 208, 196, 0.15) 0%, rgba(255, 209, 255, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #fad0c4;
    cursor: pointer;
}

.analytics-action {
    grid-column: 13 / 17;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(138, 43, 226, 0.08) 0%, rgba(75, 0, 130, 0.08) 100%);
    color: #2d3748;
    border-left: 2px solid #8a2be2;
    cursor: pointer;
}

.talent-search-action {
    grid-column: 13 / 17;
    grid-row: 3 / 4;
    background: linear-gradient(135deg, rgba(219, 192, 245, 0.15) 0%, rgba(210, 175, 242, 0.15) 100%);
    color: #2d3748;
    border-left: 2px solid #9333ea;
    cursor: pointer;
}

/* Main Content Areas */
.recent-applications {
    grid-column: 1 / 9;
    grid-row: 4 / 7;
    background: linear-gradient(135deg, rgba(250, 208, 196, 0.15) 0%, rgba(255, 209, 255, 0.15) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #fad0c4;
    min-height: 220px;
}

.job-management {
    grid-column: 9 / 17;
    grid-row: 4 / 7;
    background: linear-gradient(135deg, rgba(161, 140, 209, 0.12) 0%, rgba(251, 194, 235, 0.12) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #a18cd1;
    min-height: 220px;
}

/* Performance Metrics Row */
.performance-metrics {
    grid-column: 1 / 17;
    grid-row: 7 / 8;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    color: #2d3748;
    text-align: left;
    align-items: flex-start;
    border-left: 2px solid #667eea;
    min-height: 120px;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .hr-bento {
        grid-template-columns: repeat(12, 1fr);
    }
    
    .hr-header { grid-column: 1 / 9; }
    .hr-quick-stats { grid-column: 9 / 13; }
    
    .jobs-stat { grid-column: 1 / 3; }
    .applications-stat { grid-column: 3 / 5; }
    .pending-stat { grid-column: 5 / 7; }
    .interviews-stat { grid-column: 7 / 9; }
    .candidates-stat { grid-column: 9 / 13; }
    
    .post-job-action { grid-column: 1 / 4; }
    .view-applications-action { grid-column: 4 / 7; }
    .manage-interviews-action { grid-column: 7 / 10; }
    .analytics-action { grid-column: 10 / 13; }
    .talent-search-action { grid-column: 1 / 4; grid-row: 4 / 5; }
    
    .recent-applications { grid-column: 1 / 7; grid-row: 5 / 8; }
    .job-management { grid-column: 7 / 13; grid-row: 5 / 8; }
    
    .performance-metrics { grid-column: 1 / 13; grid-row: 8 / 9; }
}

@media (max-width: 768px) {
    .hr-bento {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(16, minmax(75px, auto));
        gap: 6px;
    }
    
    .bento-item {
        padding: 0.6rem;
        min-height: 70px;
    }
    
    .hr-header { grid-column: 1 / 5; grid-row: 1 / 2; }
    .hr-quick-stats { grid-column: 1 / 5; grid-row: 2 / 3; }
    
    .jobs-stat { grid-column: 1 / 2; grid-row: 3 / 4; }
    .applications-stat { grid-column: 2 / 3; grid-row: 3 / 4; }
    .pending-stat { grid-column: 3 / 4; grid-row: 3 / 4; }
    .interviews-stat { grid-column: 4 / 5; grid-row: 3 / 4; }
    .candidates-stat { grid-column: 1 / 5; grid-row: 4 / 5; }
    
    .post-job-action { grid-column: 1 / 5; grid-row: 5 / 6; }
    .view-applications-action { grid-column: 1 / 5; grid-row: 6 / 7; }
    .manage-interviews-action { grid-column: 1 / 5; grid-row: 7 / 8; }
    .analytics-action { grid-column: 1 / 5; grid-row: 8 / 9; }
    .talent-search-action { grid-column: 1 / 5; grid-row: 9 / 10; }
    
    .recent-applications { grid-column: 1 / 5; grid-row: 10 / 12; }
    .job-management { grid-column: 1 / 5; grid-row: 12 / 14; }
    .performance-metrics { grid-column: 1 / 5; grid-row: 14 / 16; }
}

@media (max-width: 480px) {
    .hr-bento {
        grid-template-columns: 1fr;
        gap: 4px;
    }
    
    .bento-item {
        grid-column: 1 !important;
        grid-row: auto !important;
        min-height: 65px;
        padding: 0.5rem;
    }
}

/* Typography and UI Elements */
.stat-number {
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 0.2rem;
    color: #2d3748;
    line-height: 1.1;
}

.stat-label {
    font-size: 0.75rem;
    opacity: 0.8;
    margin: 0;
    color: #4a5568;
    font-weight: 500;
    line-height: 1.2;
}

.action-icon {
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
    opacity: 0.7;
    color: #4a5568;
}

.bento-item .btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 6px;
    font-weight: 500;
}

.bento-item h5 {
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
    font-weight: 600;
    line-height: 1.2;
}

.bento-item .small {
    font-size: 0.7rem;
    margin-bottom: 0.5rem;
    opacity: 0.8;
    line-height: 1.2;
}

.activity-list {
    max-height: 180px;
    overflow-y: auto;
    width: 100%;
}

.activity-list::-webkit-scrollbar {
    width: 3px;
}

.activity-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 2px;
}

.activity-list::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
}

.activity-item {
    background: rgba(255,255,255,0.3);
    border-radius: 6px;
    padding: 0.5rem;
    margin-bottom: 0.3rem;
    transition: all 0.15s ease;
    border: 1px solid rgba(0, 0, 0, 0.03);
    font-size: 0.8rem;
    cursor: pointer;
}

.activity-item:hover {
    background: rgba(255,255,255,0.5);
    transform: translateX(3px);
    border-color: rgba(0, 0, 0, 0.08);
}

.stat-number.loading {
    opacity: 0.5;
    transition: opacity 0.3s ease;
}

.fa-spin {
    animation: fa-spin 1s infinite linear;
}

@keyframes fa-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Quick Actions Compact Design */
.quick-actions-compact {
    background: rgba(248, 249, 250, 0.8);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.quick-actions-compact .btn {
    padding: 0.4rem 0.8rem;
    margin: 0.2rem;
    font-size: 0.75rem;
    border-radius: 6px;
}

/* Performance Metrics Styling */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    width: 100%;
}

.metric-item {
    background: rgba(255,255,255,0.4);
    border-radius: 6px;
    padding: 0.8rem;
    text-align: center;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.metric-value {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.3rem;
}

.metric-label {
    font-size: 0.7rem;
    color: #4a5568;
    opacity: 0.8;
}

.progress-bar {
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 2px;
    transition: width 0.5s ease;
}

/* Purple button style for talent search */
.btn-purple {
    background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%);
    color: white;
    border: none;
}

.btn-purple:hover {
    background: linear-gradient(135deg, #7e22ce 0%, #6b21a8 100%);
    color: white;
    transform: translateY(-1px);
}

.text-purple {
    color: #9333ea !important;
}

/* Talent Search Chat Interface */
.talent-search-modal .modal-dialog {
    max-width: 900px;
}

.chat-container {
    height: 600px;
    display: flex;
    flex-direction: column;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 20px;
}

.chat-message {
    margin-bottom: 15px;
    animation: fadeInUp 0.3s ease;
}

.chat-message.user {
    text-align: right;
}

.chat-message.assistant {
    text-align: left;
}

.message-bubble {
    display: inline-block;
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 18px;
    margin: 5px;
}

.message-bubble.user {
    background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%);
    color: white;
    border-bottom-right-radius: 4px;
}

.message-bubble.assistant {
    background: white;
    color: #2d3748;
    border: 1px solid #e2e8f0;
    border-bottom-left-radius: 4px;
}

.candidate-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 16px;
    margin: 10px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: all 0.2s ease;
}

.candidate-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.match-score {
    font-size: 1.2em;
    font-weight: bold;
}

.match-score.excellent { color: #10b981; }
.match-score.good { color: #f59e0b; }
.match-score.fair { color: #ef4444; }

.follow-up-questions {
    background: #eff6ff;
    border: 1px solid #dbeafe;
    border-radius: 8px;
    padding: 12px;
    margin-top: 10px;
}

.question-btn {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 8px 12px;
    margin: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.question-btn:hover {
    background: #e5e7eb;
    border-color: #9ca3af;
}

.chat-input-container {
    display: flex;
    gap: 10px;
    align-items: end;
}

.chat-input {
    flex: 1;
    border: 2px solid #e2e8f0;
    border-radius: 20px;
    padding: 12px 20px;
    resize: none;
    max-height: 100px;
}

.chat-input:focus {
    border-color: #9333ea;
    outline: none;
    box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
}

.send-btn {
    background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.send-btn:hover {
    background: linear-gradient(135deg, #7e22ce 0%, #6b21a8 100%);
    transform: scale(1.05);
}

.typing-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6b7280;
    font-style: italic;
}

.typing-dots {
    display: flex;
    gap: 4px;
}

.typing-dot {
    width: 8px;
    height: 8px;
    background: #9ca3af;
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<div class="hr-bento">
    <!-- HR Header -->
    <div class="bento-item hr-header">
        <div class="w-100">
            <div class="d-flex justify-content-between align-items-center mb-1">
                <h4 class="mb-0 fw-bold">
                    <i class="fas fa-building me-2"></i>HR Dashboard
                </h4>
                <button class="btn btn-sm btn-outline-primary" onclick="forceRefreshHR()" title="Refresh Data">
                    <i class="fas fa-sync-alt" id="hrRefreshIcon"></i>
                </button>
            </div>
            <p class="mb-1">Talent Acquisition & Management Hub</p>
            <div class="d-flex align-items-center gap-3 mt-1">
                <small class="text-success">
                    <i class="fas fa-circle me-1" style="font-size: 0.4rem;"></i>
                    Real-time monitoring
                </small>
                <small class="text-muted" id="hrLastUpdated">Loading...</small>
            </div>
        </div>
    </div>

    <!-- Main Statistics Row -->
    <div class="bento-item jobs-stat">
        <i class="fas fa-briefcase action-icon"></i>
        <div class="stat-number" id="totalJobs">0</div>
        <p class="stat-label">Active Jobs</p>
    </div>

    <div class="bento-item applications-stat">
        <i class="fas fa-user-check action-icon"></i>
        <div class="stat-number" id="totalApplications">0</div>
        <p class="stat-label">Total Applications</p>
    </div>

    <div class="bento-item pending-stat">
        <i class="fas fa-clock action-icon text-warning"></i>
        <div class="stat-number text-warning" id="pendingReviews">0</div>
        <p class="stat-label">Pending Reviews</p>
    </div>

    <div class="bento-item interviews-stat">
        <i class="fas fa-calendar-check action-icon text-info"></i>
        <div class="stat-number text-info" id="scheduledInterviews">0</div>
        <p class="stat-label">Scheduled Interviews</p>
    </div>

    <div class="bento-item candidates-stat">
        <i class="fas fa-star action-icon text-warning"></i>
        <div class="stat-number text-warning" id="topCandidates">0</div>
        <p class="stat-label">Top Candidates</p>
    </div>

    <!-- Action Items Row -->
    <div class="bento-item post-job-action" onclick="openJobPostingModal()">
        <i class="fas fa-plus-circle action-icon text-primary"></i>
        <h5 class="mb-2">Post New Job</h5>
        <p class="small mb-3">Create job listings with AI assistance</p>
        <button class="btn btn-primary btn-sm">
            <i class="fas fa-plus me-1"></i>Create
        </button>
    </div>

    <div class="bento-item view-applications-action" onclick="viewApplications()">
        <i class="fas fa-users action-icon text-success"></i>
        <h5 class="mb-2">View Applications</h5>
        <p class="small mb-3">Review and manage candidate applications</p>
        <button class="btn btn-success btn-sm">
            <i class="fas fa-eye me-1"></i>Review
        </button>
    </div>

    <div class="bento-item manage-interviews-action" onclick="openInterviewManagement()">
        <i class="fas fa-calendar-alt action-icon text-warning"></i>
        <h5 class="mb-2">Manage Interviews</h5>
        <p class="small mb-3">Schedule and track interview processes</p>
        <button class="btn btn-warning btn-sm">
            <i class="fas fa-calendar me-1"></i>Schedule
        </button>
    </div>

    <div class="bento-item analytics-action" onclick="generateReport()">
        <i class="fas fa-chart-bar action-icon text-info"></i>
        <h5 class="mb-2">Analytics & Reports</h5>
        <p class="small mb-3">Generate insights and performance reports</p>
        <button class="btn btn-info btn-sm">
            <i class="fas fa-download me-1"></i>Generate
        </button>
    </div>

    <!-- NEW: Search Your Talent Action -->
    <div class="bento-item talent-search-action" onclick="openTalentSearch()">
        <i class="fas fa-search action-icon text-purple"></i>
        <h5 class="mb-2">Search Your Talent</h5>
        <p class="small mb-3">AI-powered natural language candidate search</p>
        <button class="btn btn-purple btn-sm">
            <i class="fas fa-brain me-1"></i>Search
        </button>
    </div>

    <!-- Recent Applications -->
    <div class="bento-item recent-applications">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-inbox me-2 text-primary"></i>
                <h5 class="mb-0">Recent Applications</h5>
            </div>
            <div class="activity-list" id="recentApplications">
                <p class="text-muted text-center">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Job Management -->
    <div class="bento-item job-management">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-tasks me-2 text-success"></i>
                <h5 class="mb-0">Active Jobs</h5>
            </div>
            <div class="activity-list" id="activeJobs">
                <p class="text-muted text-center">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="bento-item performance-metrics">
        <div class="w-100">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-chart-line me-2 text-info"></i>
                <h5 class="mb-0">Performance Metrics</h5>
            </div>
            <div class="metrics-grid" id="performanceMetrics">
                <div class="metric-item">
                    <div class="metric-value" id="applicationRate">0%</div>
                    <div class="metric-label">Application Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="applicationRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="interviewRate">0%</div>
                    <div class="metric-label">Interview Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="interviewRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="hireRate">0%</div>
                    <div class="metric-label">Hire Rate</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="hireRateBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="avgTimeToHire">0</div>
                    <div class="metric-label">Avg Days to Hire</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compact Quick Actions -->
<div class="quick-actions-compact">
    <div class="d-flex flex-wrap justify-content-center gap-1">
        <button class="btn btn-outline-primary btn-sm" onclick="loadHRJobs()">
            <i class="fas fa-list me-1"></i>All Jobs
        </button>
        <button class="btn btn-outline-success btn-sm" onclick="loadRecentApplications()">
            <i class="fas fa-users me-1"></i>Applications
        </button>
        <button class="btn btn-outline-warning btn-sm" onclick="loadInterviewSchedule()">
            <i class="fas fa-calendar me-1"></i>Interviews
        </button>
        <button class="btn btn-outline-info btn-sm" onclick="loadJobMetrics()">
            <i class="fas fa-chart-bar me-1"></i>Analytics
        </button>
        <button class="btn btn-outline-secondary btn-sm" onclick="exportHRReport()">
            <i class="fas fa-download me-1"></i>Export
        </button>
        <button class="btn btn-outline-dark btn-sm" onclick="forceRefreshHR()">
            <i class="fas fa-sync-alt me-1"></i>Refresh
        </button>
    </div>
    <div class="text-center mt-2">
        <small class="text-muted">
            <i class="fas fa-clock me-1"></i>
            <span id="hrLastUpdatedFooter">Loading...</span>
        </small>
    </div>
</div>

<!-- Job Posting Modal -->
<div class="modal fade" id="jobPostingModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Post New Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="jobPostingForm" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" name="title" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="company" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" name="min_salary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" name="max_salary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" name="description" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" name="requirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitJobPosting()">Post Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Applications Modal -->
<div class="modal fade" id="applicationsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Applications</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="jobFilter">
                            <option value="">All Jobs</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="statusFilter">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="reviewing">Reviewing</option>
                            <option value="interview">Interview</option>
                            <option value="hired">Hired</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="applicantSearch" placeholder="Search applicants...">
                    </div>
                </div>
                <div id="applicationsTable"></div>
                <div id="applicationsPagination" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

<!-- HR Job Management Section -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Job Management</h5>
            <div class="btn-group">
                <button class="btn btn-outline-primary btn-sm" onclick="loadHRJobs()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createJobModal">
                    <i class="fas fa-plus me-1"></i>Add New Job
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Job Filters -->
        <div class="row mb-3">
            <div class="col-md-3">
                <select id="hrJobStatusFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="all">All Status</option>
                    <option value="active" selected>Active Jobs</option>
                    <option value="inactive">Inactive Jobs</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="hrJobCategoryFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="hrJobDateFilter" class="form-select form-select-sm" onchange="loadHRJobs()">
                    <option value="all">All Time</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="30d" selected>Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="input-group input-group-sm">
                    <input type="text" id="hrJobSearch" class="form-control" placeholder="Search jobs...">
                    <button class="btn btn-outline-secondary" type="button" onclick="loadHRJobs()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Jobs Table -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAllJobs" class="form-check-input">
                        </th>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Applications</th>
                        <th>Created</th>
                        <th>Last Activity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="hrJobsTable">
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions -->
        <div class="d-flex justify-content-between mt-3">
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="bulkActionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Bulk Actions
                </button>
                <ul class="dropdown-menu" aria-labelledby="bulkActionDropdown">
                    <li><a class="dropdown-item" href="#" onclick="bulkJobStatusChange(true)">Activate Selected</a></li>
                    <li><a class="dropdown-item" href="#" onclick="bulkJobStatusChange(false)">Deactivate Selected</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" onclick="bulkCategoryChange()">Change Category</a></li>
                </ul>
            </div>
            
            <!-- Pagination -->
            <nav aria-label="Jobs pagination">
                <ul class="pagination pagination-sm mb-0" id="hrJobsPagination">
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Job Metrics and Analytics Section -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Job Performance Analytics</h5>
            <div class="btn-group">
                <select id="metricsTimeRange" class="form-select form-select-sm" onchange="loadJobMetrics()">
                    <option value="7d">Last 7 Days</option>
                    <option value="30d" selected>Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                    <option value="all">All Time</option>
                </select>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="row" id="jobMetricsContainer">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Applications Over Time</h6>
                        <canvas id="applicationsTimeChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Status Breakdown</h6>
                        <canvas id="statusBreakdownChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Category Performance</h6>
                        <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Jobs</th>
                                        <th>Applications</th>
                                        <th>Avg/Job</th>
                                    </tr>
                                </thead>
                                <tbody id="categoryPerformanceTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Top Performing Jobs</h6>
                        <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Job Title</th>
                                        <th>Applications</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="topJobsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Job Modal -->
<div class="modal fade" id="editJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editJobForm" class="needs-validation" novalidate>
                    <input type="hidden" id="editJobId">
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="editJobTitle" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" id="editJobCompany" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="editJobLocation" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" id="editJobType" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="editJobCategory" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" id="editMinSalary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" id="editMaxSalary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" id="editJobDescription" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" id="editJobRequirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateHRJob()">Update Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Job Modal -->
<div class="modal fade" id="createJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createJobForm" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-control" name="title" required>
                        <div class="invalid-feedback">Please enter a job title</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="company" required>
                            <div class="invalid-feedback">Please enter company name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" required>
                            <div class="invalid-feedback">Please enter job location</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Type</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select type...</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                            <div class="invalid-feedback">Please select job type</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select category...</option>
                                <option value="software">Software Development</option>
                                <option value="data">Data Science</option>
                                <option value="design">Design</option>
                                <option value="product">Product Management</option>
                                <option value="marketing">Marketing</option>
                                <option value="sales">Sales</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select job category</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Min Salary (Annual)</label>
                            <input type="number" class="form-control" name="min_salary">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Max Salary (Annual)</label>
                            <input type="number" class="form-control" name="max_salary">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" name="description" rows="5" required></textarea>
                        <div class="invalid-feedback">Please enter job description</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Requirements</label>
                        <textarea class="form-control" name="requirements" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter job requirements</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createHRJob()">Create Job</button>
            </div>
        </div>
    </div>
</div>

<!-- Interview Scheduling Modal -->
<div class="modal fade" id="scheduleInterviewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Schedule Interview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="scheduleInterviewForm">
                    <input type="hidden" id="interviewApplicationId" name="application_id">
                    
                    <!-- Candidate Info -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Candidate</label>
                            <div class="p-2 bg-light rounded" id="candidateInfo">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Position</label>
                            <div class="p-2 bg-light rounded" id="positionInfo">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interview Details -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="interviewType" class="form-label">Interview Type</label>
                            <select class="form-select" id="interviewType" name="interview_type" required>
                                <option value="phone">Phone Interview</option>
                                <option value="video">Video Interview</option>
                                <option value="technical" selected>Technical Interview</option>
                                <option value="hr">HR Interview</option>
                                <option value="final">Final Interview</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewTitle" class="form-label">Interview Title</label>
                            <input type="text" class="form-control" id="interviewTitle" name="title" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="interviewDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="interviewDescription" name="description" rows="3" placeholder="Interview agenda, topics to cover, etc."></textarea>
                    </div>
                    
                    <!-- Scheduling -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="interviewDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="interviewDate" name="interview_date" required>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewTime" class="form-label">Time</label>
                            <input type="time" class="form-control" id="interviewTime" name="interview_time" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="duration" class="form-label">Duration (minutes)</label>
                            <select class="form-select" id="duration" name="duration_minutes">
                                <option value="30">30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="interviewLocation" class="form-label">Location/Room</label>
                            <input type="text" class="form-control" id="interviewLocation" name="location" placeholder="Conference Room A, Zoom, etc.">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="meetingLink" class="form-label">Meeting Link (for video interviews)</label>
                        <input type="url" class="form-control" id="meetingLink" name="meeting_link" placeholder="https://zoom.us/j/...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitInterviewSchedule()">Schedule Interview</button>
            </div>
        </div>
    </div>
</div>

<!-- Interview Management Modal -->
<div class="modal fade" id="interviewManagementModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Interview Management</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Filters and Actions -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="interviewStatusFilter" onchange="loadInterviews()">
                            <option value="">All Statuses</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" id="interviewTypeFilter" onchange="loadInterviews()">
                            <option value="">All Types</option>
                            <option value="phone">Phone</option>
                            <option value="video">Video</option>
                            <option value="technical">Technical</option>
                            <option value="hr">HR</option>
                            <option value="final">Final</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="date" class="form-control form-control-sm" id="interviewDateFrom" onchange="loadInterviews()">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control form-control-sm" id="interviewDateTo" onchange="loadInterviews()">
                        </div>
                    </div>
                </div>
                
                <!-- Interviews Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Candidate & Position</th>
                                <th>Type</th>
                                <th>Title</th>
                                <th>Scheduled</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="interviewsTableBody">
                            <!-- Will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav id="interviewsPagination" aria-label="Interviews pagination">
                    <!-- Will be populated dynamically -->
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Talent Search Modal -->
<div class="modal fade talent-search-modal" id="talentSearchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%);">
                <h5 class="modal-title text-white">
                    <i class="fas fa-brain me-2"></i>Search Your Talent
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="message-bubble assistant">
                                <i class="fas fa-robot me-2"></i>
                                Hi! I'm your AI talent search assistant. Tell me what kind of candidate you're looking for, and I'll help you find the perfect match from your talent pool.
                                <br><br>
                                <strong>Try asking:</strong><br>
                                 "I need an AI engineer with 3+ years experience"<br>
                                 "Find me React developers for a startup"<br>
                                 "Show me data scientists with Python skills"
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-3">
                        <div class="chat-input-container">
                            <textarea 
                                id="chatInput" 
                                class="chat-input" 
                                placeholder="Describe the candidate you're looking for..."
                                rows="2"
                                onkeypress="handleChatKeyPress(event)"
                            ></textarea>
                            <button class="send-btn" onclick="sendTalentSearchQuery()" id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <div class="mt-2 text-center">
                            <small class="text-muted">
                                <i class="fas fa-lightbulb me-1"></i>
                                Be as specific as possible for better results
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
// Global variables for HR dashboard
let hrRefreshInterval;
let hrLastUpdateTime = 0;

// Helper function to get auth headers
function getAuthHeaders() {
    const token = localStorage.getItem('token');
    return token ? { 'Authorization': `Bearer ${token}` } : {};
}

// Helper function to show alerts
function showAlert(message, type = 'info', duration = 5000) {
    // Remove existing alerts
    const existingAlerts = document.querySelectorAll('.alert-floating');
    existingAlerts.forEach(alert => alert.remove());
    
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed alert-floating`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    if (duration > 0) {
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, duration);
    }
}

// Helper functions for loading states
function showLoadingState() {
    const loadingElements = document.querySelectorAll('.stat-number');
    loadingElements.forEach(el => {
        if (!el.classList.contains('loading')) {
            el.classList.add('loading');
            el.textContent = '...';
        }
    });
}

function hideLoadingState() {
    const loadingElements = document.querySelectorAll('.stat-number.loading');
    loadingElements.forEach(el => {
        el.classList.remove('loading');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
    loadJobsForFilter();
    loadHRJobs();
    loadJobMetrics();
    
    // Setup auto-refresh every 30 seconds for real-time updates
    hrRefreshInterval = setInterval(function() {
        loadDashboardData();
    }, 30000);
    
    // Setup event listeners
    document.getElementById('selectAllJobs')?.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#hrJobsTable input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
    
    // Interview scheduling form submission
    const scheduleInterviewForm = document.getElementById('scheduleInterviewForm');
    if (scheduleInterviewForm) {
        scheduleInterviewForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            await submitInterviewSchedule();
        });
    }
});

async function loadDashboardData() {
    try {
        showLoadingState();
        
        // Load application stats
        const statsResponse = await fetch('/api/jobs/applications/stats/hr', {
            headers: getAuthHeaders()
        });
        
        // Load HR metrics for additional data
        const metricsResponse = await fetch('/api/jobs/hr/metrics?time_range=30d', {
            headers: getAuthHeaders()
        });
        
        let statsData = {};
        let metricsData = {};
        
        if (statsResponse.ok) {
            const result = await statsResponse.json();
            statsData = result.stats || {};
        }
        
        if (metricsResponse.ok) {
            const result = await metricsResponse.json();
            metricsData = result.metrics || {};
        }
        
        // Combine data and update dashboard
        updateDashboardStats(statsData, metricsData);
        
        // Load recent applications and jobs
        await Promise.all([
            loadRecentApplications(),
            loadActiveJobs(),
            loadInterviewSchedule()
        ]);
        
        hideLoadingState();
        updateLastUpdatedIndicator();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        showAlert('Error loading dashboard data', 'danger');
        hideLoadingState();
    }
}

function updateDashboardStats(statsData, metricsData) {
    // Update main stats cards
    updateStatElement('totalJobs', metricsData.total_jobs || 0);
    updateStatElement('totalApplications', statsData.total || 0);
    updateStatElement('pendingReviews', statsData.pending || 0);
    
    // Calculate top candidates (shortlisted + reviewed)
    const topCandidates = (statsData.shortlisted || 0) + (statsData.reviewed || 0);
    updateStatElement('topCandidates', topCandidates);
    
    // Update performance metrics
    updatePerformanceMetrics(statsData, metricsData);
}

function updateStatElement(elementId, value) {
    const element = document.getElementById(elementId);
    if (element && element.textContent !== value.toString()) {
        element.classList.add('loading');
        setTimeout(() => {
            element.textContent = value;
            element.classList.remove('loading');
            
            // Add a subtle animation
            element.style.transform = 'scale(1.1)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }, 150);
    }
}

function updatePerformanceMetrics(statsData, metricsData) {
    const totalJobs = metricsData.total_jobs || 1;
    const totalApplications = statsData.total || 0;
    
    // Calculate rates
    const applicationRate = totalJobs > 0 ? Math.round((totalApplications / totalJobs) * 10) : 0;
    const interviewRate = totalApplications > 0 ? Math.round(((statsData.shortlisted || 0) / totalApplications) * 100) : 0;
    const hireRate = totalApplications > 0 ? Math.round(((statsData.reviewed || 0) / totalApplications) * 100) : 0;
    const avgTimeToHire = metricsData.avg_time_to_hire || 0;
    
    // Update elements
    updateStatElement('applicationRate', Math.min(applicationRate, 100) + '%');
    updateStatElement('interviewRate', interviewRate + '%');
    updateStatElement('hireRate', hireRate + '%');
    updateStatElement('avgTimeToHire', Math.round(avgTimeToHire));
    
    // Update progress bars
    const applicationRateBar = document.getElementById('applicationRateBar');
    const interviewRateBar = document.getElementById('interviewRateBar');
    const hireRateBar = document.getElementById('hireRateBar');
    
    if (applicationRateBar) applicationRateBar.style.width = Math.min(applicationRate, 100) + '%';
    if (interviewRateBar) interviewRateBar.style.width = interviewRate + '%';
    if (hireRateBar) hireRateBar.style.width = hireRate + '%';
}

async function loadRecentApplications() {
    try {
        const response = await fetch('/api/jobs/applications/recent', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const applications = result.applications || [];
            displayRecentApplications(applications);
        } else {
            document.getElementById('recentApplications').innerHTML = 
                '<div class="text-center py-4"><p class="text-muted">No recent applications found</p></div>';
        }
    } catch (error) {
        console.error('Error loading recent applications:', error);
        document.getElementById('recentApplications').innerHTML = 
            '<div class="text-center py-4"><p class="text-danger">Error loading applications</p></div>';
    }
}

function displayRecentApplications(applications) {
    const container = document.getElementById('recentApplications');
    if (!container) return;
    
    if (!applications || applications.length === 0) {
        container.innerHTML = '<div class="text-center py-4"><p class="text-muted">No recent applications</p></div>';
        return;
    }
    
    container.innerHTML = applications.slice(0, 5).map(app => `
        <div class="activity-item" onclick="viewApplicationDetails(${app.id})">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>${app.resume?.name || app.candidate_name || 'Unknown'}</strong>
                    <br>
                    <small class="text-muted">
                        ${app.job?.title || app.job_title || 'Unknown Position'}  
                        <span class="badge bg-${getStatusColor(app.status)} text-white">
                            ${app.status || 'pending'}
                        </span>
                    </small>
                </div>
                <div class="d-flex align-items-center gap-2">
                    ${typeof app.match_score === 'number' ? 
                        `<div class="text-center">
                            <div class="small text-muted">Match</div>
                            <div class="fw-bold text-${app.match_score >= 80 ? 'success' : app.match_score >= 60 ? 'warning' : 'danger'}">
                                ${Math.round(app.match_score)}%
                            </div>
                        </div>` : ''
                    }
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </div>
    `).join('');
}

async function loadActiveJobs() {
    try {
        const response = await fetch('/api/jobs/hr?status=active&per_page=5', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const jobs = result.jobs || [];
            displayActiveJobs(jobs);
        } else {
            document.getElementById('activeJobs').innerHTML = 
                '<div class="text-center py-4"><p class="text-muted">No active jobs found</p></div>';
        }
    } catch (error) {
        console.error('Error loading active jobs:', error);
        document.getElementById('activeJobs').innerHTML = 
            '<div class="text-center py-4"><p class="text-danger">Error loading jobs</p></div>';
    }
}

function displayActiveJobs(jobs) {
    const container = document.getElementById('activeJobs');
    if (!container) return;
    
    if (!jobs || jobs.length === 0) {
        container.innerHTML = '<div class="text-center py-4"><p class="text-muted">No active jobs</p></div>';
        return;
    }
    
    container.innerHTML = jobs.slice(0, 5).map(job => `
        <div class="activity-item" onclick="editJob(${job.id})">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>${job.title}</strong>
                    <br>
                    <small class="text-muted">
                        ${job.company}  ${job.location}  
                        <span class="badge bg-success">Active</span>
                    </small>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <div class="text-center">
                        <div class="small text-muted">Applications</div>
                        <div class="fw-bold text-primary">${job.application_count || 0}</div>
                    </div>
                    <i class="fas fa-chevron-right text-muted"></i>
                </div>
            </div>
        </div>
    `).join('');
}

async function loadInterviewSchedule() {
    try {
        const response = await fetch('/api/interviews/upcoming', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            const interviews = result.interviews || [];
            updateStatElement('scheduledInterviews', interviews.length);
        }
    } catch (error) {
        console.error('Error loading interview schedule:', error);
    }
}

function getStatusColor(status) {
    if (!status) return 'secondary';
    
    switch (status.toLowerCase()) {
        case 'accepted': 
        case 'hired': return 'success';
        case 'rejected': return 'danger';
        case 'pending': return 'warning';
        case 'interview': 
        case 'interviewing': return 'info';
        case 'withdrawn': return 'dark';
        case 'reviewing': return 'primary';
        default: return 'secondary';
    }
}

function forceRefreshHR() {
    const refreshIcon = document.getElementById('hrRefreshIcon');
    if (refreshIcon) {
        refreshIcon.classList.add('fa-spin');
    }
    
    loadDashboardData().finally(() => {
        if (refreshIcon) {
            refreshIcon.classList.remove('fa-spin');
        }
    });
}

// Talent Search Functions
let talentSearchConversationId = null;

function openTalentSearch() {
    const modal = new bootstrap.Modal(document.getElementById('talentSearchModal'));
    modal.show();
    
    // Generate new conversation ID if not exists
    if (!talentSearchConversationId) {
        talentSearchConversationId = 'conv_' + Date.now();
    }
    
    // Focus on input when modal is shown
    document.getElementById('chatInput').focus();
}

function handleChatKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendTalentSearchQuery();
    }
}

async function sendTalentSearchQuery() {
    const input = document.getElementById('chatInput');
    const query = input.value.trim();
    
    if (!query) return;
    
    // Clear input and disable send button
    input.value = '';
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.disabled = true;
    
    // Add user message to chat
    addChatMessage('user', query);
    
    // Show typing indicator
    showTypingIndicator();
    
    try {
        const response = await fetch('/api/talent-search/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                ...getAuthHeaders()
            },
            body: JSON.stringify({
                query: query,
                conversation_id: talentSearchConversationId
            })
        });
        
        if (!response.ok) {
            throw new Error('Search request failed');
        }
        
        const data = await response.json();
        
        // Remove typing indicator
        removeTypingIndicator();
        
        // Add AI response
        addChatMessage('assistant', data.ai_response);
        
        // Show candidates if found
        if (data.candidates && data.candidates.length > 0) {
            displayCandidateResults(data.candidates);
        }
        
        // Show follow-up questions
        if (data.follow_up_questions && data.follow_up_questions.length > 0) {
            displayFollowUpQuestions(data.follow_up_questions);
        }
        
        // Show search summary
        if (data.search_summary) {
            displaySearchSummary(data.search_summary);
        }
        
    } catch (error) {
        console.error('Error in talent search:', error);
        removeTypingIndicator();
        addChatMessage('assistant', 'Sorry, I encountered an error while searching. Please try again.');
    } finally {
        sendBtn.disabled = false;
        input.focus();
    }
}

function addChatMessage(role, content) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${role}`;
    
    const bubbleDiv = document.createElement('div');
    bubbleDiv.className = `message-bubble ${role}`;
    
    if (role === 'assistant') {
        bubbleDiv.innerHTML = `<i class="fas fa-robot me-2"></i>${content}`;
    } else {
        bubbleDiv.textContent = content;
    }
    
    messageDiv.appendChild(bubbleDiv);
    chatMessages.appendChild(messageDiv);
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showTypingIndicator() {
    const chatMessages = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'chat-message assistant typing-indicator-message';
    typingDiv.id = 'typingIndicator';
    
    typingDiv.innerHTML = `
        <div class="message-bubble assistant">
            <div class="typing-indicator">
                <span>AI is thinking</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>
    `;
    
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function removeTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

function displayCandidateResults(candidates) {
    const chatMessages = document.getElementById('chatMessages');
    const resultsDiv = document.createElement('div');
    resultsDiv.className = 'chat-message assistant';
    
    let candidatesHtml = '<div class="message-bubble assistant" style="max-width: 90%;">';
    candidatesHtml += `<h6><i class="fas fa-users me-2"></i>Top Matching Candidates:</h6>`;
    
    candidates.forEach((candidate, index) => {
        const matchScoreClass = candidate.match_score >= 80 ? 'excellent' : 
                               candidate.match_score >= 60 ? 'good' : 'fair';
        
        candidatesHtml += `
            <div class="candidate-card" onclick="viewCandidateDetails(${candidate.id})">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <h6 class="mb-1">${candidate.name || 'Unknown'}</h6>
                        <small class="text-muted">${candidate.email || ''}</small>
                    </div>
                    <span class="match-score ${matchScoreClass}">${candidate.match_score}% match</span>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <small><strong>Skills:</strong></small><br>
                        ${candidate.skills.slice(0, 4).map(skill => 
                            `<span class="badge bg-light text-dark me-1">${skill}</span>`
                        ).join('')}
                        ${candidate.skills.length > 4 ? `<span class="text-muted">+${candidate.skills.length - 4} more</span>` : ''}
                    </div>
                    <div class="col-md-6">
                        <small><strong>Experience:</strong></small><br>
                        ${candidate.experience_summary.slice(0, 1).map(exp => 
                            `<small class="text-muted">${exp.title || exp.position || 'Position'} at ${exp.company || 'Company'}</small>`
                        ).join('<br>')}
                    </div>
                </div>
                
                ${candidate.match_details && candidate.match_details.strengths.length > 0 ? `
                    <div class="mt-2">
                        <small><strong>Key Strengths:</strong></small><br>
                        <small class="text-success">${candidate.match_details.strengths.slice(0, 2).join(', ')}</small>
                    </div>
                ` : ''}
                
                <div class="mt-2 text-end">
                    <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); downloadResume(${candidate.id})">
                        <i class="fas fa-download me-1"></i>Resume
                    </button>
                    <button class="btn btn-sm btn-purple" onclick="event.stopPropagation(); viewCandidateDetails(${candidate.id})">
                        <i class="fas fa-eye me-1"></i>View Details
                    </button>
                </div>
            </div>
        `;
    });
    
    candidatesHtml += '</div>';
    resultsDiv.innerHTML = candidatesHtml;
    
    chatMessages.appendChild(resultsDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function displayFollowUpQuestions(questions) {
    const chatMessages = document.getElementById('chatMessages');
    const questionsDiv = document.createElement('div');
    questionsDiv.className = 'chat-message assistant';
    
    let questionsHtml = `
        <div class="message-bubble assistant">
            <div class="follow-up-questions">
                <small><strong><i class="fas fa-question-circle me-2"></i>I can help you refine your search:</strong></small><br>
                <div class="mt-2">
    `;
    
    questions.forEach(question => {
        questionsHtml += `
            <div class="question-btn" onclick="askFollowUpQuestion('${question.replace(/'/g, "\\'")}')">
                ${question}
            </div>
        `;
    });
    
    questionsHtml += `
                </div>
            </div>
        </div>
    `;
    
    questionsDiv.innerHTML = questionsHtml;
    chatMessages.appendChild(questionsDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function displaySearchSummary(summary) {
    const chatMessages = document.getElementById('chatMessages');
    const summaryDiv = document.createElement('div');
    summaryDiv.className = 'chat-message assistant';
    
    const summaryHtml = `
        <div class="message-bubble assistant" style="background: #f0f9ff; border-color: #0ea5e9;">
            <small>
                <i class="fas fa-info-circle me-2 text-info"></i>
                <strong>Search Summary:</strong><br>
                Searched ${summary.total_candidates_searched} candidates  
                Found ${summary.matches_found} matches  
                ${Math.round(summary.search_confidence * 100)}% confidence
            </small>
        </div>
    `;
    
    summaryDiv.innerHTML = summaryHtml;
    chatMessages.appendChild(summaryDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function askFollowUpQuestion(question) {
    document.getElementById('chatInput').value = question;
    sendTalentSearchQuery();
}

async function viewCandidateDetails(candidateId) {
    try {
        const response = await fetch(`/api/talent-search/candidate/${candidateId}/details`, {
            headers: getAuthHeaders()
        });
        
        if (!response.ok) {
            throw new Error('Failed to load candidate details');
        }
        
        const data = await response.json();
        const candidate = data.candidate;
        
        // Create detailed modal
        const modalHtml = `
            <div class="modal fade" id="candidateDetailModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-user me-2"></i>${candidate.name || 'Candidate Details'}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Contact Information</h6>
                                    <p><strong>Email:</strong> ${candidate.email || 'N/A'}</p>
                                    <p><strong>Phone:</strong> ${candidate.phone || 'N/A'}</p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Resume Information</h6>
                                    <p><strong>File:</strong> ${candidate.filename || 'N/A'}</p>
                                    <p><strong>Uploaded:</strong> ${new Date(candidate.created_at).toLocaleDateString()}</p>
                                </div>
                            </div>
                            
                            ${candidate.skills && candidate.skills.length > 0 ? `
                                <hr>
                                <h6>Skills</h6>
                                <div class="mb-3">
                                    ${candidate.skills.map(skill => 
                                        `<span class="badge bg-primary me-1 mb-1">${skill}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                            
                            ${candidate.experience && candidate.experience.length > 0 ? `
                                <hr>
                                <h6>Experience</h6>
                                ${candidate.experience.map(exp => `
                                    <div class="card mb-2">
                                        <div class="card-body py-2">
                                            <h6 class="card-title mb-1">${exp.title || exp.position || 'Position'}</h6>
                                            <p class="card-text mb-1">
                                                <strong>${exp.company || 'Company'}</strong>
                                                ${exp.duration ? `  ${exp.duration}` : ''}
                                            </p>
                                            ${exp.description ? `<small class="text-muted">${exp.description}</small>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            ` : ''}
                            
                            ${candidate.application_history && candidate.application_history.length > 0 ? `
                                <hr>
                                <h6>Application History</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Position</th>
                                                <th>Company</th>
                                                <th>Status</th>
                                                <th>Applied</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${candidate.application_history.map(app => `
                                                <tr>
                                                    <td>${app.job_title}</td>
                                                    <td>${app.company}</td>
                                                    <td><span class="badge bg-${getStatusColor(app.status)}">${app.status}</span></td>
                                                    <td>${new Date(app.applied_at).toLocaleDateString()}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" onclick="downloadResume(${candidate.id})">
                                <i class="fas fa-download me-1"></i>Download Resume
                            </button>
                            <button type="button" class="btn btn-purple" onclick="scheduleInterviewFromCandidate(${candidate.id})">
                                <i class="fas fa-calendar me-1"></i>Schedule Interview
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Remove existing modal
        const existingModal = document.getElementById('candidateDetailModal');
        if (existingModal) existingModal.remove();
        
        // Add new modal
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('candidateDetailModal'));
        modal.show();
        
    } catch (error) {
        console.error('Error loading candidate details:', error);
        showAlert('Could not load candidate details', 'danger');
    }
}

function scheduleInterviewFromCandidate(candidateId) {
    // Close candidate detail modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('candidateDetailModal'));
    if (modal) modal.hide();
    
    showAlert('Feature coming soon: Direct interview scheduling from talent search!', 'info');
}

function downloadResume(resumeId) {
    const token = localStorage.getItem('token');
    const url = `/api/resumes/${resumeId}/download?token=${encodeURIComponent(token)}`;
    window.open(url, '_blank');
}

function updateLastUpdatedIndicator() {
    const now = new Date();
    const timeString = now.toLocaleTimeString();
    
    const lastUpdatedElements = ['hrLastUpdated', 'hrLastUpdatedFooter'];
    lastUpdatedElements.forEach(elementId => {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = `Last updated: ${timeString}`;
        }
    });
    
    hrLastUpdateTime = Date.now();
}

// Action functions
function openJobPostingModal() {
    const modal = new bootstrap.Modal(document.getElementById('jobPostingModal'));
    modal.show();
}

function viewApplications() {
    const modal = new bootstrap.Modal(document.getElementById('applicationsModal'));
    modal.show();
    // Load applications data when modal opens
    loadApplicationsTable();
}

function openInterviewManagement() {
    // Navigate to interview management page or open modal
    window.location.href = '/hr/interviews';
}

function generateReport() {
    showAlert('Generating comprehensive HR report...', 'info');
    // Implement report generation logic
    setTimeout(() => {
        showAlert('Report generated successfully!', 'success');
    }, 2000);
}

function exportHRReport() {
    showAlert('Exporting HR data...', 'info');
    // Implement export functionality
    setTimeout(() => {
        showAlert('HR report exported to Downloads folder', 'success');
    }, 1500);
}

// Job management functions
async function submitJobPosting() {
    const form = document.getElementById('jobPostingForm');
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }
    
    const formData = new FormData(form);
    const jobData = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch('/api/jobs/', {
            method: 'POST',
            headers: {
                ...getAuthHeaders(),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(jobData)
        });
        
        if (response.ok) {
            showAlert('Job posted successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('jobPostingModal')).hide();
            form.reset();
            form.classList.remove('was-validated');
            loadDashboardData();
        } else {
            const error = await response.json();
            showAlert(error.message || 'Failed to post job', 'danger');
        }
    } catch (error) {
        console.error('Error posting job:', error);
        showAlert('Error posting job', 'danger');
    }
}

async function loadApplicationsTable() {
    // Implementation for loading applications table
    // This would populate the applications modal with data
    try {
        const response = await fetch('/api/jobs/applications/all', {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            // Populate applications table
            displayApplicationsTable(result.applications || []);
        }
    } catch (error) {
        console.error('Error loading applications:', error);
        document.getElementById('applicationsTable').innerHTML = `
            <div class="alert alert-danger">
                Error loading applications
            </div>
        `;
    }
}

function displayApplicationsTable(applications) {
    const container = document.getElementById('applicationsTable');
    if (!container) return;
    
    // Create comprehensive table view of all applications
    if (!applications || applications.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No applications found</div>';
        return;
    }
    
    const table = `
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Candidate</th>
                        <th>Job Position</th>
                        <th>Status</th>
                        <th>Applied Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${applications.map(app => `
                        <tr>
                            <td>
                                <div class="fw-bold">${app.candidate_name || 'Unknown'}</div>
                                <small class="text-muted">${app.candidate_email || ''}</small>
                            </td>
                            <td>${app.job_title || 'Unknown Position'}</td>
                            <td>
                                <span class="badge bg-${getStatusColor(app.status)}">
                                    ${app.status || 'Pending'}
                                </span>
                            </td>
                            <td>${formatDate(app.applied_at || app.created_at)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewApplicationDetails(${app.id})">
                                    View
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
    container.innerHTML = table;
}

async function viewApplicationDetails(applicationId) {
    try {
        const response = await fetch(`/api/jobs/applications/${applicationId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            showApplicationDetailsModal(result.application);
        } else {
            showAlert('Could not load application details', 'danger');
        }
    } catch (error) {
        console.error('Error loading application details:', error);
        showAlert('Error loading application details', 'danger');
    }
}

function showApplicationDetailsModal(application) {
    // Create a modal to show application details
    const modalHtml = `
        <div class="modal fade" id="applicationDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Application Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Candidate Information</h6>
                                <p><strong>Name:</strong> ${application.resume?.name || 'N/A'}</p>
                                <p><strong>Email:</strong> ${application.resume?.email || 'N/A'}</p>
                                <p><strong>Phone:</strong> ${application.resume?.phone || 'N/A'}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Application Details</h6>
                                <p><strong>Position:</strong> ${application.job?.title || 'N/A'}</p>
                                <p><strong>Applied On:</strong> ${new Date(application.created_at).toLocaleDateString()}</p>
                                <p><strong>Status:</strong> 
                                    <span class="badge bg-${getStatusColor(application.status)}">${application.status}</span>
                                </p>
                                ${application.match_score ? `<p><strong>Match Score:</strong> ${Math.round(application.match_score)}%</p>` : ''}
                            </div>
                        </div>
                        ${application.cover_letter ? `
                            <div class="mt-3">
                                <h6>Cover Letter</h6>
                                <p>${application.cover_letter}</p>
                            </div>
                        ` : ''}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" onclick="updateApplicationStatus(${application.id}, 'interviewed')">
                            Schedule Interview
                        </button>
                        <button type="button" class="btn btn-primary" onclick="updateApplicationStatus(${application.id}, 'reviewed')">
                            Mark as Reviewed
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if present
    const existingModal = document.getElementById('applicationDetailsModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to body and show
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('applicationDetailsModal'));
    modal.show();
}

async function updateApplicationStatus(applicationId, newStatus) {
    try {
        const response = await fetch(`/api/jobs/applications/${applicationId}`, {
            method: 'PUT',
            headers: {
                ...getAuthHeaders(),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus })
        });
        
        if (response.ok) {
            showAlert(`Application status updated to ${newStatus}`, 'success');
            // Close modal and refresh data
            bootstrap.Modal.getInstance(document.getElementById('applicationDetailsModal')).hide();
            loadRecentApplications();
        } else {
            showAlert('Failed to update application status', 'danger');
        }
    } catch (error) {
        console.error('Error updating application status:', error);
        showAlert('Error updating application status', 'danger');
    }
}

// Edit job function
function editJob(jobId) {
    showAlert('Job editing functionality coming soon!', 'info');
    // TODO: Implement job editing modal
}

/* Advanced Talent Search Functions */
async function openAdvancedSearch() {
    const modalHtml = `
        <div class="modal fade" id="advancedSearchModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-search-plus me-2"></i>Advanced Talent Search
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="advancedSearchForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Job Title/Role</label>
                                    <input type="text" class="form-control" id="searchJobTitle" placeholder="e.g., Software Engineer">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Experience Level</label>
                                    <select class="form-select" id="searchExperience">
                                        <option value="">Any</option>
                                        <option value="0-2">Entry Level (0-2 years)</option>
                                        <option value="3-5">Mid Level (3-5 years)</option>
                                        <option value="6-10">Senior Level (6-10 years)</option>
                                        <option value="10+">Expert Level (10+ years)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Required Skills</label>
                                    <input type="text" class="form-control" id="searchSkills" placeholder="JavaScript, React, Node.js">
                                    <small class="text-muted">Separate skills with commas</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" id="searchLocation" placeholder="New York, Remote">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Education Level</label>
                                    <select class="form-select" id="searchEducation">
                                        <option value="">Any</option>
                                        <option value="high-school">High School</option>
                                        <option value="associate">Associate Degree</option>
                                        <option value="bachelor">Bachelor's Degree</option>
                                        <option value="master">Master's Degree</option>
                                        <option value="phd">PhD</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Search Method</label>
                                    <select class="form-select" id="searchMethod">
                                        <option value="standard">Standard Search</option>
                                        <option value="rag">RAG Enhanced Search</option>
                                        <option value="both">Compare Both Methods</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Additional Requirements</label>
                                <textarea class="form-control" id="searchRequirements" rows="3" placeholder="Any specific requirements or preferences..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="executeAdvancedSearch()">
                            <i class="fas fa-search me-1"></i>Search Candidates
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('advancedSearchModal'));
    modal.show();
    
    // Remove modal when hidden
    modal._element.addEventListener('hidden.bs.modal', () => {
        document.getElementById('advancedSearchModal').remove();
    });
}

async function executeAdvancedSearch() {
    const formData = {
        job_title: document.getElementById('searchJobTitle').value,
        experience: document.getElementById('searchExperience').value,
        skills: document.getElementById('searchSkills').value.split(',').map(s => s.trim()).filter(s => s),
        location: document.getElementById('searchLocation').value,
        education: document.getElementById('searchEducation').value,
        requirements: document.getElementById('searchRequirements').value,
        search_method: document.getElementById('searchMethod').value
    };
    
    // Build search query from form data
    let query = '';
    if (formData.job_title) query += `Find ${formData.job_title} candidates `;
    if (formData.experience) query += `with ${formData.experience} years of experience `;
    if (formData.skills.length > 0) query += `skilled in ${formData.skills.join(', ')} `;
    if (formData.location) query += `located in ${formData.location} `;
    if (formData.education) query += `with ${formData.education} education `;
    if (formData.requirements) query += `. Additional requirements: ${formData.requirements}`;
    
    // Close advanced search modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('advancedSearchModal'));
    modal.hide();
    
    // Execute search based on method
    if (formData.search_method === 'rag') {
        await executeRAGSearch(query, formData);
    } else if (formData.search_method === 'both') {
        await compareSearchMethods(query, formData);
    } else {
        await executeStandardSearch(query);
    }
}

async function executeRAGSearch(query, filters) {
    try {
        showAlert('Executing RAG-enhanced search...', 'info', 0);
        
        const response = await fetch('/api/talent-search/rag-search', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                query: query,
                filters: filters,
                top_k: 15
            })
        });
        
        const data = await response.json();
        
        document.querySelectorAll('.alert').forEach(alert => alert.remove());
        
        if (response.ok && data.success) {
            displaySearchResults(data.search_results, 'RAG Enhanced Search Results');
        } else {
            showAlert(data.error || 'RAG search failed', 'danger');
        }
        
    } catch (error) {
        console.error('Error in RAG search:', error);
        showAlert('RAG search failed. Please try again.', 'danger');
    }
}

async function compareSearchServices() {
    const query = document.getElementById('chatInput').value.trim();
    if (!query) {
        showAlert('Please enter a search query first', 'warning');
        return;
    }
    
    try {
        showAlert('Comparing search services...', 'info', 0);
        
        const response = await fetch('/api/talent-search/compare-services', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query: query })
        });
        
        const data = await response.json();
        
        document.querySelectorAll('.alert').forEach(alert => alert.remove());
        
        if (response.ok && data.success) {
            displayServiceComparison(data.comparison);
        } else {
            showAlert(data.error || 'Service comparison failed', 'danger');
        }
        
    } catch (error) {
        console.error('Error comparing services:', error);
        showAlert('Service comparison failed. Please try again.', 'danger');
    }
}

async function viewRAGStatus() {
    try {
        showAlert('Loading RAG system status...', 'info', 0);
        
        const response = await fetch('/api/talent-search/rag/status', {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        const data = await response.json();
        
        document.querySelectorAll('.alert').forEach(alert => alert.remove());
        
        if (response.ok && data.success) {
            displayRAGStatus(data);
        } else {
            showAlert(data.error || 'Failed to load RAG status', 'danger');
        }
        
    } catch (error) {
        console.error('Error loading RAG status:', error);
        showAlert('Failed to load RAG status. Please try again.', 'danger');
    }
}

function displayServiceComparison(comparison) {
    const modalHtml = `
        <div class="modal fade" id="serviceComparisonModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-balance-scale me-2"></i>Search Service Comparison
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Standard Search Service</h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Candidates Found:</strong> ${comparison.standard_service.total_found || 0}</p>
                                        <p><strong>Search Method:</strong> Traditional keyword matching</p>
                                        <div class="candidates-list">
                                            ${(comparison.standard_service.candidates || []).slice(0, 5).map(candidate => `
                                                <div class="candidate-card small mb-2">
                                                    <strong>${candidate.name}</strong> - ${(candidate.match_score || 0).toFixed(1)}% match
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">RAG Enhanced Service</h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Candidates Found:</strong> ${comparison.rag_service.length || 0}</p>
                                        <p><strong>Search Method:</strong> Vector similarity + semantic understanding</p>
                                        <div class="candidates-list">
                                            ${(comparison.rag_service || []).slice(0, 5).map(candidate => `
                                                <div class="candidate-card small mb-2">
                                                    <strong>${candidate.name || candidate.candidate_name || 'Unknown'}</strong> - Semantic match
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('serviceComparisonModal'));
    modal.show();
    
    modal._element.addEventListener('hidden.bs.modal', () => {
        document.getElementById('serviceComparisonModal').remove();
    });
}

function displayRAGStatus(statusData) {
    const modalHtml = `
        <div class="modal fade" id="ragStatusModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-database me-2"></i>RAG System Status
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Database Counts</h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Total Resumes:</strong> ${statusData.database_counts?.resumes || 0}</p>
                                        <p><strong>Total Jobs:</strong> ${statusData.database_counts?.jobs || 0}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Vector Database</h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Indexed Documents:</strong> ${statusData.vector_database?.indexed_documents || 0}</p>
                                        <p><strong>Last Updated:</strong> ${statusData.timestamp ? new Date(statusData.timestamp).toLocaleString() : 'Unknown'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Actions</h6>
                                </div>
                                <div class="card-body">
                                    <button class="btn btn-primary me-2" onclick="forceSyncAll()">
                                        <i class="fas fa-sync me-1"></i>Force Sync All Data
                                    </button>
                                    <button class="btn btn-info" onclick="refreshRAGStatus()">
                                        <i class="fas fa-refresh me-1"></i>Refresh Status
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('ragStatusModal'));
    modal.show();
    
    modal._element.addEventListener('hidden.bs.modal', () => {
        document.getElementById('ragStatusModal').remove();
    });
}

async function forceSyncAll() {
    try {
        showAlert('Starting full data synchronization...', 'info', 0);
        
        const response = await fetch('/api/talent-search/force-sync', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        const data = await response.json();
        
        document.querySelectorAll('.alert').forEach(alert => alert.remove());
        
        if (response.ok && data.success) {
            showAlert(`Sync completed! Resumes: ${data.results.resumes.success}/${data.results.resumes.success + data.results.resumes.failed}, Jobs: ${data.results.jobs.success}/${data.results.jobs.success + data.results.jobs.failed}`, 'success');
        } else {
            showAlert(data.error || 'Sync failed', 'danger');
        }
        
    } catch (error) {
        console.error('Error in force sync:', error);
        showAlert('Sync failed. Please try again.', 'danger');
    }
}

async function refreshRAGStatus() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('ragStatusModal'));
    modal.hide();
    await viewRAGStatus();
}

// HR Jobs Management Functions
async function loadHRJobs() {
    try {
        // Get filter values
        const status = document.getElementById('hrJobStatusFilter')?.value || 'active';
        const category = document.getElementById('hrJobCategoryFilter')?.value || '';
        const dateRange = document.getElementById('hrJobDateFilter')?.value || '30d';
        const search = document.getElementById('hrJobSearch')?.value || '';
        
        // Build query parameters
        const params = new URLSearchParams({
            status: status,
            date_range: dateRange,
            per_page: '20'
        });
        
        if (category) params.append('category', category);
        if (search) params.append('search', search);
        
        const response = await fetch(`/api/jobs/hr?${params}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const result = await response.json();
            displayHRJobsTable(result.jobs || []);
        } else {
            document.getElementById('hrJobsTable').innerHTML = `
                <tr>
                    <td colspan="7" class="text-center py-4">
                        <div class="alert alert-warning">Failed to load jobs</div>
                    </td>
                </tr>
            `;
        }
    } catch (error) {
        console.error('Error loading HR jobs:', error);
        document.getElementById('hrJobsTable').innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="alert alert-danger">Error loading jobs</div>
                </td>
            </tr>
        `;
    }
}

function displayHRJobsTable(jobs) {
    const tableBody = document.getElementById('hrJobsTable');
    if (!tableBody) return;
    
    if (!jobs || jobs.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="text-muted">No jobs found</div>
                </td>
            </tr>
        `;
        return;
    }
    
    tableBody.innerHTML = jobs.map(job => `
        <tr>
            <td>
                <input type="checkbox" class="form-check-input job-checkbox" value="${job.id}">
            </td>
            <td>
                <div class="fw-bold">${job.title}</div>
                <small class="text-muted">${job.company}</small>
            </td>
            <td>
                <span class="badge bg-${job.is_active ? 'success' : 'secondary'}">
                    ${job.is_active ? 'Active' : 'Inactive'}
                </span>
            </td>
            <td>
                <span class="badge bg-primary">${job.applications_count || 0}</span>
                ${job.pending_applications ? `<small class="text-warning">(${job.pending_applications} pending)</small>` : ''}
            </td>
            <td>
                <small>${formatDate(job.created_at)}</small>
            </td>
            <td>
                <small>${formatDate(job.updated_at || job.created_at)}</small>
            </td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewJobDetails(${job.id})" title="View">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-secondary" onclick="editJob(${job.id})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-${job.is_active ? 'warning' : 'success'}" 
                            onclick="toggleJobStatus(${job.id}, ${!job.is_active})" 
                            title="${job.is_active ? 'Deactivate' : 'Activate'}">
                        <i class="fas fa-${job.is_active ? 'pause' : 'play'}"></i>
                    </button>
                </div>
            </td>
        </tr>
    `).join('');
}

async function toggleJobStatus(jobId, newStatus) {
    try {
        const response = await fetch(`/api/jobs/${jobId}`, {
            method: 'PUT',
            headers: {
                ...getAuthHeaders(),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                is_active: newStatus
            })
        });
        
        if (response.ok) {
            showAlert(`Job ${newStatus ? 'activated' : 'deactivated'} successfully`, 'success');
            loadHRJobs(); // Reload the table
        } else {
            showAlert('Failed to update job status', 'danger');
        }
    } catch (error) {
        console.error('Error toggling job status:', error);
        showAlert('Error updating job status', 'danger');
    }
}

async function viewJobDetails(jobId) {
    try {
        // First check if the job exists via API
        const response = await fetch(`/api/jobs/${jobId}`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            // Job exists, open the details page
            window.open(`/jobs/${jobId}`, '_blank');
        } else {
            // Job doesn't exist or access denied
            showAlert('Job not found or you do not have permission to view it', 'warning');
        }
    } catch (error) {
        console.error('Error checking job existence:', error);
        showAlert('Error accessing job details', 'danger');
    }
}

function editJob(jobId) {
    // Implement job editing functionality
    showAlert('Job editing functionality coming soon', 'info');
}

function bulkJobStatusChange(activate) {
    const selectedJobs = Array.from(document.querySelectorAll('.job-checkbox:checked')).map(cb => cb.value);
    if (selectedJobs.length === 0) {
        showAlert('Please select jobs to update', 'warning');
        return;
    }
    
    // Implement bulk status change
    showAlert(`Bulk ${activate ? 'activation' : 'deactivation'} functionality coming soon`, 'info');
}

function bulkCategoryChange() {
    const selectedJobs = Array.from(document.querySelectorAll('.job-checkbox:checked')).map(cb => cb.value);
    if (selectedJobs.length === 0) {
        showAlert('Please select jobs to update', 'warning');
        return;
    }
    
    // Implement bulk category change
    showAlert('Bulk category change functionality coming soon', 'info');
}
</script>
{% endblock %}
